commit 5a13e34211a1b10d0b01ab85f10a6c3754fd0092
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue May 1 12:04:46 2012 +0200

    Heyu 2.10
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/version.h b/version.h
index 95c7238..a45a6c7 100644
--- a/version.h
+++ b/version.h
@@ -18,5 +18,5 @@
  * It should be manually changed when the version number is ready to be
  * bumped up.
  */
-#define VERSION "2.10-rc3"
-#define RELEASE_DATE "20111119"
+#define VERSION "2.10"
+#define RELEASE_DATE "20120501"

commit d4d1f192f6afc0f0c3f7670de8af73f7714f16dc
Merge: 572ec5d 08c2ec7
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue May 1 12:02:17 2012 +0200

    Merge branch 'testing' into stable
    
    * testing: (31 commits)
      Update Makefile.in to follow GPL related changes
      Switch over to GPL
      Fix find_lockup_scripts() function definition mismatch
      Engine: don't handle checksums when processing RF signals
      Attempt to fix Visonic support
      Fix argument type passed from check4poll() to set_counter()
      Enhance recognition of X10 Standard RF same signal bursts
      Revert "Compare RFXCOM X10 signal bursts by type, not by length"
      Heyu 2.10-rc2
      Update RCS related Heyu documentation bits
      Prevent from checksums being incorrectly recognised as events
      Fix single 0xff checksum processing
      Fix 0xff checksum before triple 0xff mark case
      Use a negative value for no checksum alert
      Compare RFXCOM X10 signal bursts by type, not by length
      Completely stop using select() as a *sleep() replacement
      Drop millisleep(10) from xread() not only on Darwin
      Heyu 2.10-rc1
      Add support for RFXLAN, a networked RFXCOM variant
      Allow for precise dawn/dusk, night/notnight definition
      ...

commit 08c2ec7c4da5cd03b7cdefb55f8ac0c831f11ba3
Merge: bc5d2b3 6d8b328
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue May 1 11:53:52 2012 +0200

    Merge branch 'for-next' into testing
    
    * for-next:
      Update Makefile.in to follow GPL related changes
      Switch over to GPL
      Fix find_lockup_scripts() function definition mismatch

commit 6d8b328c22877809fd37a7f6e8a3c3c771f26243
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue Dec 27 22:06:11 2011 +0100

    Update Makefile.in to follow GPL related changes
    
    Update the list of other source files: replace LICENSE with AUTHORS, add
    GPLv3 COPYING.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/Makefile.in b/Makefile.in
index 8e9b28b..84ea379 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -34,7 +34,7 @@ OBJS =	date.o erase.o info.o message.o relay.o \
 OTHERSRC = README README2 Makefile x10config.sample protocol.txt eeprom.h \
 	x10.sched.sample  heyu.1 x10.h x10config.5 x10cm17a.5 \
 	history.txt version.h heyufaq.txt x10sched.5 process.h sun.h \
-	x10scripts.5 Configure Makefile.in install.sh INSTALL LICENSE \
+	x10scripts.5 Configure Makefile.in install.sh AUTHORS COPYING INSTALL \
         README.cm10a x10aux.5 x10state.h rfxcom.h digimax.h oregon.h x10rfxsensors.5\
 	x10rfxmeters.5 x10digimax.5 x10oregon.5 x10kaku.5 README.webhook 
 

commit a5bbe07ec19fd17c85fb14ef3d8192caf5f1df51
Author: Daniel B. Suthers <dbs@tanj.com>
Date:   Thu Sep 8 12:04:22 2011 +0200

    Switch over to GPL
    
    This patch removes all previous license terms embedded in Heyu source
    files, leaving only copyright or equivalent messages by their authors.
    A few header (.h) files missing any such messages so far are completed
    with them, taken from their corresponding .c files.
    
    A new license statement section, referring to GPL v3, is then added to
    all source files, and a new file, COPYING, with the GPL v3 text, is
    provided.
    
    The former LICENSE file is moved over to GNU compliant AUTHORS after
    removing all license related messages from it.
    
    Signed-off-by: Daniel B. Suthers <dbs@tanj.com>
    Acked-by: James B. Sullivan, Executor of the Charles W. Sullivan Estate
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/AUTHORS b/AUTHORS
new file mode 100644
index 0000000..e609543
--- /dev/null
+++ b/AUTHORS
@@ -0,0 +1,25 @@
+/*----------------------------------------------------------------------------+
+ |                                                                            |
+ |       HEYU - a control program for the X10 CM11A serial interface          |
+ |                                                                            |
+ |         Portions copyright 2002, 2004-2007 Charles W. Sullivan             |
+ |     Portions copyright 1996, 1997, 1998, 1999, 2002 Daniel B. Suthers      |
+ |                Portions copyright 1986 Larry Campbell                      |
+ |                                                                            |
+ |  Entire program copyright 2007 Charles W. Sullivan and Daniel B. Suthers   |
+ |                                                                            |
+ |                                                                            |
+ | As used herein, HEYU is a trademark of Daniel B. Suthers.                  |
+ |                                                                            |
+ | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
+ | SwitchLinc and LampLinc are trademarks of Smarthome, Inc.                  |
+ |                                                                            |
+ | The authors are not affiliated with either company.                        |
+ |                                                                            |
+ | Charles W. Sullivan                                                        |
+ | Co-author and Maintainer                                                   |
+ | Greensboro, North Carolina                                                 |
+ | Email ID: cwsulliv01                                                       |
+ | Email domain: -at- heyu -dot- org                                          |
+ |                                                                            |
+ +----------------------------------------------------------------------------*/
diff --git a/COPYING b/COPYING
new file mode 100644
index 0000000..94a9ed0
--- /dev/null
+++ b/COPYING
@@ -0,0 +1,674 @@
+                    GNU GENERAL PUBLIC LICENSE
+                       Version 3, 29 June 2007
+
+ Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+                            Preamble
+
+  The GNU General Public License is a free, copyleft license for
+software and other kinds of works.
+
+  The licenses for most software and other practical works are designed
+to take away your freedom to share and change the works.  By contrast,
+the GNU General Public License is intended to guarantee your freedom to
+share and change all versions of a program--to make sure it remains free
+software for all its users.  We, the Free Software Foundation, use the
+GNU General Public License for most of our software; it applies also to
+any other work released this way by its authors.  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+them if you wish), that you receive source code or can get it if you
+want it, that you can change the software or use pieces of it in new
+free programs, and that you know you can do these things.
+
+  To protect your rights, we need to prevent others from denying you
+these rights or asking you to surrender the rights.  Therefore, you have
+certain responsibilities if you distribute copies of the software, or if
+you modify it: responsibilities to respect the freedom of others.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must pass on to the recipients the same
+freedoms that you received.  You must make sure that they, too, receive
+or can get the source code.  And you must show them these terms so they
+know their rights.
+
+  Developers that use the GNU GPL protect your rights with two steps:
+(1) assert copyright on the software, and (2) offer you this License
+giving you legal permission to copy, distribute and/or modify it.
+
+  For the developers' and authors' protection, the GPL clearly explains
+that there is no warranty for this free software.  For both users' and
+authors' sake, the GPL requires that modified versions be marked as
+changed, so that their problems will not be attributed erroneously to
+authors of previous versions.
+
+  Some devices are designed to deny users access to install or run
+modified versions of the software inside them, although the manufacturer
+can do so.  This is fundamentally incompatible with the aim of
+protecting users' freedom to change the software.  The systematic
+pattern of such abuse occurs in the area of products for individuals to
+use, which is precisely where it is most unacceptable.  Therefore, we
+have designed this version of the GPL to prohibit the practice for those
+products.  If such problems arise substantially in other domains, we
+stand ready to extend this provision to those domains in future versions
+of the GPL, as needed to protect the freedom of users.
+
+  Finally, every program is threatened constantly by software patents.
+States should not allow patents to restrict development and use of
+software on general-purpose computers, but in those that do, we wish to
+avoid the special danger that patents applied to a free program could
+make it effectively proprietary.  To prevent this, the GPL assures that
+patents cannot be used to render the program non-free.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+                       TERMS AND CONDITIONS
+
+  0. Definitions.
+
+  "This License" refers to version 3 of the GNU General Public License.
+
+  "Copyright" also means copyright-like laws that apply to other kinds of
+works, such as semiconductor masks.
+
+  "The Program" refers to any copyrightable work licensed under this
+License.  Each licensee is addressed as "you".  "Licensees" and
+"recipients" may be individuals or organizations.
+
+  To "modify" a work means to copy from or adapt all or part of the work
+in a fashion requiring copyright permission, other than the making of an
+exact copy.  The resulting work is called a "modified version" of the
+earlier work or a work "based on" the earlier work.
+
+  A "covered work" means either the unmodified Program or a work based
+on the Program.
+
+  To "propagate" a work means to do anything with it that, without
+permission, would make you directly or secondarily liable for
+infringement under applicable copyright law, except executing it on a
+computer or modifying a private copy.  Propagation includes copying,
+distribution (with or without modification), making available to the
+public, and in some countries other activities as well.
+
+  To "convey" a work means any kind of propagation that enables other
+parties to make or receive copies.  Mere interaction with a user through
+a computer network, with no transfer of a copy, is not conveying.
+
+  An interactive user interface displays "Appropriate Legal Notices"
+to the extent that it includes a convenient and prominently visible
+feature that (1) displays an appropriate copyright notice, and (2)
+tells the user that there is no warranty for the work (except to the
+extent that warranties are provided), that licensees may convey the
+work under this License, and how to view a copy of this License.  If
+the interface presents a list of user commands or options, such as a
+menu, a prominent item in the list meets this criterion.
+
+  1. Source Code.
+
+  The "source code" for a work means the preferred form of the work
+for making modifications to it.  "Object code" means any non-source
+form of a work.
+
+  A "Standard Interface" means an interface that either is an official
+standard defined by a recognized standards body, or, in the case of
+interfaces specified for a particular programming language, one that
+is widely used among developers working in that language.
+
+  The "System Libraries" of an executable work include anything, other
+than the work as a whole, that (a) is included in the normal form of
+packaging a Major Component, but which is not part of that Major
+Component, and (b) serves only to enable use of the work with that
+Major Component, or to implement a Standard Interface for which an
+implementation is available to the public in source code form.  A
+"Major Component", in this context, means a major essential component
+(kernel, window system, and so on) of the specific operating system
+(if any) on which the executable work runs, or a compiler used to
+produce the work, or an object code interpreter used to run it.
+
+  The "Corresponding Source" for a work in object code form means all
+the source code needed to generate, install, and (for an executable
+work) run the object code and to modify the work, including scripts to
+control those activities.  However, it does not include the work's
+System Libraries, or general-purpose tools or generally available free
+programs which are used unmodified in performing those activities but
+which are not part of the work.  For example, Corresponding Source
+includes interface definition files associated with source files for
+the work, and the source code for shared libraries and dynamically
+linked subprograms that the work is specifically designed to require,
+such as by intimate data communication or control flow between those
+subprograms and other parts of the work.
+
+  The Corresponding Source need not include anything that users
+can regenerate automatically from other parts of the Corresponding
+Source.
+
+  The Corresponding Source for a work in source code form is that
+same work.
+
+  2. Basic Permissions.
+
+  All rights granted under this License are granted for the term of
+copyright on the Program, and are irrevocable provided the stated
+conditions are met.  This License explicitly affirms your unlimited
+permission to run the unmodified Program.  The output from running a
+covered work is covered by this License only if the output, given its
+content, constitutes a covered work.  This License acknowledges your
+rights of fair use or other equivalent, as provided by copyright law.
+
+  You may make, run and propagate covered works that you do not
+convey, without conditions so long as your license otherwise remains
+in force.  You may convey covered works to others for the sole purpose
+of having them make modifications exclusively for you, or provide you
+with facilities for running those works, provided that you comply with
+the terms of this License in conveying all material for which you do
+not control copyright.  Those thus making or running the covered works
+for you must do so exclusively on your behalf, under your direction
+and control, on terms that prohibit them from making any copies of
+your copyrighted material outside their relationship with you.
+
+  Conveying under any other circumstances is permitted solely under
+the conditions stated below.  Sublicensing is not allowed; section 10
+makes it unnecessary.
+
+  3. Protecting Users' Legal Rights From Anti-Circumvention Law.
+
+  No covered work shall be deemed part of an effective technological
+measure under any applicable law fulfilling obligations under article
+11 of the WIPO copyright treaty adopted on 20 December 1996, or
+similar laws prohibiting or restricting circumvention of such
+measures.
+
+  When you convey a covered work, you waive any legal power to forbid
+circumvention of technological measures to the extent such circumvention
+is effected by exercising rights under this License with respect to
+the covered work, and you disclaim any intention to limit operation or
+modification of the work as a means of enforcing, against the work's
+users, your or third parties' legal rights to forbid circumvention of
+technological measures.
+
+  4. Conveying Verbatim Copies.
+
+  You may convey verbatim copies of the Program's source code as you
+receive it, in any medium, provided that you conspicuously and
+appropriately publish on each copy an appropriate copyright notice;
+keep intact all notices stating that this License and any
+non-permissive terms added in accord with section 7 apply to the code;
+keep intact all notices of the absence of any warranty; and give all
+recipients a copy of this License along with the Program.
+
+  You may charge any price or no price for each copy that you convey,
+and you may offer support or warranty protection for a fee.
+
+  5. Conveying Modified Source Versions.
+
+  You may convey a work based on the Program, or the modifications to
+produce it from the Program, in the form of source code under the
+terms of section 4, provided that you also meet all of these conditions:
+
+    a) The work must carry prominent notices stating that you modified
+    it, and giving a relevant date.
+
+    b) The work must carry prominent notices stating that it is
+    released under this License and any conditions added under section
+    7.  This requirement modifies the requirement in section 4 to
+    "keep intact all notices".
+
+    c) You must license the entire work, as a whole, under this
+    License to anyone who comes into possession of a copy.  This
+    License will therefore apply, along with any applicable section 7
+    additional terms, to the whole of the work, and all its parts,
+    regardless of how they are packaged.  This License gives no
+    permission to license the work in any other way, but it does not
+    invalidate such permission if you have separately received it.
+
+    d) If the work has interactive user interfaces, each must display
+    Appropriate Legal Notices; however, if the Program has interactive
+    interfaces that do not display Appropriate Legal Notices, your
+    work need not make them do so.
+
+  A compilation of a covered work with other separate and independent
+works, which are not by their nature extensions of the covered work,
+and which are not combined with it such as to form a larger program,
+in or on a volume of a storage or distribution medium, is called an
+"aggregate" if the compilation and its resulting copyright are not
+used to limit the access or legal rights of the compilation's users
+beyond what the individual works permit.  Inclusion of a covered work
+in an aggregate does not cause this License to apply to the other
+parts of the aggregate.
+
+  6. Conveying Non-Source Forms.
+
+  You may convey a covered work in object code form under the terms
+of sections 4 and 5, provided that you also convey the
+machine-readable Corresponding Source under the terms of this License,
+in one of these ways:
+
+    a) Convey the object code in, or embodied in, a physical product
+    (including a physical distribution medium), accompanied by the
+    Corresponding Source fixed on a durable physical medium
+    customarily used for software interchange.
+
+    b) Convey the object code in, or embodied in, a physical product
+    (including a physical distribution medium), accompanied by a
+    written offer, valid for at least three years and valid for as
+    long as you offer spare parts or customer support for that product
+    model, to give anyone who possesses the object code either (1) a
+    copy of the Corresponding Source for all the software in the
+    product that is covered by this License, on a durable physical
+    medium customarily used for software interchange, for a price no
+    more than your reasonable cost of physically performing this
+    conveying of source, or (2) access to copy the
+    Corresponding Source from a network server at no charge.
+
+    c) Convey individual copies of the object code with a copy of the
+    written offer to provide the Corresponding Source.  This
+    alternative is allowed only occasionally and noncommercially, and
+    only if you received the object code with such an offer, in accord
+    with subsection 6b.
+
+    d) Convey the object code by offering access from a designated
+    place (gratis or for a charge), and offer equivalent access to the
+    Corresponding Source in the same way through the same place at no
+    further charge.  You need not require recipients to copy the
+    Corresponding Source along with the object code.  If the place to
+    copy the object code is a network server, the Corresponding Source
+    may be on a different server (operated by you or a third party)
+    that supports equivalent copying facilities, provided you maintain
+    clear directions next to the object code saying where to find the
+    Corresponding Source.  Regardless of what server hosts the
+    Corresponding Source, you remain obligated to ensure that it is
+    available for as long as needed to satisfy these requirements.
+
+    e) Convey the object code using peer-to-peer transmission, provided
+    you inform other peers where the object code and Corresponding
+    Source of the work are being offered to the general public at no
+    charge under subsection 6d.
+
+  A separable portion of the object code, whose source code is excluded
+from the Corresponding Source as a System Library, need not be
+included in conveying the object code work.
+
+  A "User Product" is either (1) a "consumer product", which means any
+tangible personal property which is normally used for personal, family,
+or household purposes, or (2) anything designed or sold for incorporation
+into a dwelling.  In determining whether a product is a consumer product,
+doubtful cases shall be resolved in favor of coverage.  For a particular
+product received by a particular user, "normally used" refers to a
+typical or common use of that class of product, regardless of the status
+of the particular user or of the way in which the particular user
+actually uses, or expects or is expected to use, the product.  A product
+is a consumer product regardless of whether the product has substantial
+commercial, industrial or non-consumer uses, unless such uses represent
+the only significant mode of use of the product.
+
+  "Installation Information" for a User Product means any methods,
+procedures, authorization keys, or other information required to install
+and execute modified versions of a covered work in that User Product from
+a modified version of its Corresponding Source.  The information must
+suffice to ensure that the continued functioning of the modified object
+code is in no case prevented or interfered with solely because
+modification has been made.
+
+  If you convey an object code work under this section in, or with, or
+specifically for use in, a User Product, and the conveying occurs as
+part of a transaction in which the right of possession and use of the
+User Product is transferred to the recipient in perpetuity or for a
+fixed term (regardless of how the transaction is characterized), the
+Corresponding Source conveyed under this section must be accompanied
+by the Installation Information.  But this requirement does not apply
+if neither you nor any third party retains the ability to install
+modified object code on the User Product (for example, the work has
+been installed in ROM).
+
+  The requirement to provide Installation Information does not include a
+requirement to continue to provide support service, warranty, or updates
+for a work that has been modified or installed by the recipient, or for
+the User Product in which it has been modified or installed.  Access to a
+network may be denied when the modification itself materially and
+adversely affects the operation of the network or violates the rules and
+protocols for communication across the network.
+
+  Corresponding Source conveyed, and Installation Information provided,
+in accord with this section must be in a format that is publicly
+documented (and with an implementation available to the public in
+source code form), and must require no special password or key for
+unpacking, reading or copying.
+
+  7. Additional Terms.
+
+  "Additional permissions" are terms that supplement the terms of this
+License by making exceptions from one or more of its conditions.
+Additional permissions that are applicable to the entire Program shall
+be treated as though they were included in this License, to the extent
+that they are valid under applicable law.  If additional permissions
+apply only to part of the Program, that part may be used separately
+under those permissions, but the entire Program remains governed by
+this License without regard to the additional permissions.
+
+  When you convey a copy of a covered work, you may at your option
+remove any additional permissions from that copy, or from any part of
+it.  (Additional permissions may be written to require their own
+removal in certain cases when you modify the work.)  You may place
+additional permissions on material, added by you to a covered work,
+for which you have or can give appropriate copyright permission.
+
+  Notwithstanding any other provision of this License, for material you
+add to a covered work, you may (if authorized by the copyright holders of
+that material) supplement the terms of this License with terms:
+
+    a) Disclaiming warranty or limiting liability differently from the
+    terms of sections 15 and 16 of this License; or
+
+    b) Requiring preservation of specified reasonable legal notices or
+    author attributions in that material or in the Appropriate Legal
+    Notices displayed by works containing it; or
+
+    c) Prohibiting misrepresentation of the origin of that material, or
+    requiring that modified versions of such material be marked in
+    reasonable ways as different from the original version; or
+
+    d) Limiting the use for publicity purposes of names of licensors or
+    authors of the material; or
+
+    e) Declining to grant rights under trademark law for use of some
+    trade names, trademarks, or service marks; or
+
+    f) Requiring indemnification of licensors and authors of that
+    material by anyone who conveys the material (or modified versions of
+    it) with contractual assumptions of liability to the recipient, for
+    any liability that these contractual assumptions directly impose on
+    those licensors and authors.
+
+  All other non-permissive additional terms are considered "further
+restrictions" within the meaning of section 10.  If the Program as you
+received it, or any part of it, contains a notice stating that it is
+governed by this License along with a term that is a further
+restriction, you may remove that term.  If a license document contains
+a further restriction but permits relicensing or conveying under this
+License, you may add to a covered work material governed by the terms
+of that license document, provided that the further restriction does
+not survive such relicensing or conveying.
+
+  If you add terms to a covered work in accord with this section, you
+must place, in the relevant source files, a statement of the
+additional terms that apply to those files, or a notice indicating
+where to find the applicable terms.
+
+  Additional terms, permissive or non-permissive, may be stated in the
+form of a separately written license, or stated as exceptions;
+the above requirements apply either way.
+
+  8. Termination.
+
+  You may not propagate or modify a covered work except as expressly
+provided under this License.  Any attempt otherwise to propagate or
+modify it is void, and will automatically terminate your rights under
+this License (including any patent licenses granted under the third
+paragraph of section 11).
+
+  However, if you cease all violation of this License, then your
+license from a particular copyright holder is reinstated (a)
+provisionally, unless and until the copyright holder explicitly and
+finally terminates your license, and (b) permanently, if the copyright
+holder fails to notify you of the violation by some reasonable means
+prior to 60 days after the cessation.
+
+  Moreover, your license from a particular copyright holder is
+reinstated permanently if the copyright holder notifies you of the
+violation by some reasonable means, this is the first time you have
+received notice of violation of this License (for any work) from that
+copyright holder, and you cure the violation prior to 30 days after
+your receipt of the notice.
+
+  Termination of your rights under this section does not terminate the
+licenses of parties who have received copies or rights from you under
+this License.  If your rights have been terminated and not permanently
+reinstated, you do not qualify to receive new licenses for the same
+material under section 10.
+
+  9. Acceptance Not Required for Having Copies.
+
+  You are not required to accept this License in order to receive or
+run a copy of the Program.  Ancillary propagation of a covered work
+occurring solely as a consequence of using peer-to-peer transmission
+to receive a copy likewise does not require acceptance.  However,
+nothing other than this License grants you permission to propagate or
+modify any covered work.  These actions infringe copyright if you do
+not accept this License.  Therefore, by modifying or propagating a
+covered work, you indicate your acceptance of this License to do so.
+
+  10. Automatic Licensing of Downstream Recipients.
+
+  Each time you convey a covered work, the recipient automatically
+receives a license from the original licensors, to run, modify and
+propagate that work, subject to this License.  You are not responsible
+for enforcing compliance by third parties with this License.
+
+  An "entity transaction" is a transaction transferring control of an
+organization, or substantially all assets of one, or subdividing an
+organization, or merging organizations.  If propagation of a covered
+work results from an entity transaction, each party to that
+transaction who receives a copy of the work also receives whatever
+licenses to the work the party's predecessor in interest had or could
+give under the previous paragraph, plus a right to possession of the
+Corresponding Source of the work from the predecessor in interest, if
+the predecessor has it or can get it with reasonable efforts.
+
+  You may not impose any further restrictions on the exercise of the
+rights granted or affirmed under this License.  For example, you may
+not impose a license fee, royalty, or other charge for exercise of
+rights granted under this License, and you may not initiate litigation
+(including a cross-claim or counterclaim in a lawsuit) alleging that
+any patent claim is infringed by making, using, selling, offering for
+sale, or importing the Program or any portion of it.
+
+  11. Patents.
+
+  A "contributor" is a copyright holder who authorizes use under this
+License of the Program or a work on which the Program is based.  The
+work thus licensed is called the contributor's "contributor version".
+
+  A contributor's "essential patent claims" are all patent claims
+owned or controlled by the contributor, whether already acquired or
+hereafter acquired, that would be infringed by some manner, permitted
+by this License, of making, using, or selling its contributor version,
+but do not include claims that would be infringed only as a
+consequence of further modification of the contributor version.  For
+purposes of this definition, "control" includes the right to grant
+patent sublicenses in a manner consistent with the requirements of
+this License.
+
+  Each contributor grants you a non-exclusive, worldwide, royalty-free
+patent license under the contributor's essential patent claims, to
+make, use, sell, offer for sale, import and otherwise run, modify and
+propagate the contents of its contributor version.
+
+  In the following three paragraphs, a "patent license" is any express
+agreement or commitment, however denominated, not to enforce a patent
+(such as an express permission to practice a patent or covenant not to
+sue for patent infringement).  To "grant" such a patent license to a
+party means to make such an agreement or commitment not to enforce a
+patent against the party.
+
+  If you convey a covered work, knowingly relying on a patent license,
+and the Corresponding Source of the work is not available for anyone
+to copy, free of charge and under the terms of this License, through a
+publicly available network server or other readily accessible means,
+then you must either (1) cause the Corresponding Source to be so
+available, or (2) arrange to deprive yourself of the benefit of the
+patent license for this particular work, or (3) arrange, in a manner
+consistent with the requirements of this License, to extend the patent
+license to downstream recipients.  "Knowingly relying" means you have
+actual knowledge that, but for the patent license, your conveying the
+covered work in a country, or your recipient's use of the covered work
+in a country, would infringe one or more identifiable patents in that
+country that you have reason to believe are valid.
+
+  If, pursuant to or in connection with a single transaction or
+arrangement, you convey, or propagate by procuring conveyance of, a
+covered work, and grant a patent license to some of the parties
+receiving the covered work authorizing them to use, propagate, modify
+or convey a specific copy of the covered work, then the patent license
+you grant is automatically extended to all recipients of the covered
+work and works based on it.
+
+  A patent license is "discriminatory" if it does not include within
+the scope of its coverage, prohibits the exercise of, or is
+conditioned on the non-exercise of one or more of the rights that are
+specifically granted under this License.  You may not convey a covered
+work if you are a party to an arrangement with a third party that is
+in the business of distributing software, under which you make payment
+to the third party based on the extent of your activity of conveying
+the work, and under which the third party grants, to any of the
+parties who would receive the covered work from you, a discriminatory
+patent license (a) in connection with copies of the covered work
+conveyed by you (or copies made from those copies), or (b) primarily
+for and in connection with specific products or compilations that
+contain the covered work, unless you entered into that arrangement,
+or that patent license was granted, prior to 28 March 2007.
+
+  Nothing in this License shall be construed as excluding or limiting
+any implied license or other defenses to infringement that may
+otherwise be available to you under applicable patent law.
+
+  12. No Surrender of Others' Freedom.
+
+  If conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot convey a
+covered work so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you may
+not convey it at all.  For example, if you agree to terms that obligate you
+to collect a royalty for further conveying from those to whom you convey
+the Program, the only way you could satisfy both those terms and this
+License would be to refrain entirely from conveying the Program.
+
+  13. Use with the GNU Affero General Public License.
+
+  Notwithstanding any other provision of this License, you have
+permission to link or combine any covered work with a work licensed
+under version 3 of the GNU Affero General Public License into a single
+combined work, and to convey the resulting work.  The terms of this
+License will continue to apply to the part which is the covered work,
+but the special requirements of the GNU Affero General Public License,
+section 13, concerning interaction through a network will apply to the
+combination as such.
+
+  14. Revised Versions of this License.
+
+  The Free Software Foundation may publish revised and/or new versions of
+the GNU General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+  Each version is given a distinguishing version number.  If the
+Program specifies that a certain numbered version of the GNU General
+Public License "or any later version" applies to it, you have the
+option of following the terms and conditions either of that numbered
+version or of any later version published by the Free Software
+Foundation.  If the Program does not specify a version number of the
+GNU General Public License, you may choose any version ever published
+by the Free Software Foundation.
+
+  If the Program specifies that a proxy can decide which future
+versions of the GNU General Public License can be used, that proxy's
+public statement of acceptance of a version permanently authorizes you
+to choose that version for the Program.
+
+  Later license versions may give you additional or different
+permissions.  However, no additional obligations are imposed on any
+author or copyright holder as a result of your choosing to follow a
+later version.
+
+  15. Disclaimer of Warranty.
+
+  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
+APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
+HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
+OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
+THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
+IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
+ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
+
+  16. Limitation of Liability.
+
+  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
+THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
+GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
+USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
+DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
+PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
+EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
+SUCH DAMAGES.
+
+  17. Interpretation of Sections 15 and 16.
+
+  If the disclaimer of warranty and limitation of liability provided
+above cannot be given local legal effect according to their terms,
+reviewing courts shall apply local law that most closely approximates
+an absolute waiver of all civil liability in connection with the
+Program, unless a warranty or assumption of liability accompanies a
+copy of the Program in return for a fee.
+
+                     END OF TERMS AND CONDITIONS
+
+            How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+state the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This program is free software: you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program.  If not, see <http://www.gnu.org/licenses/>.
+
+Also add information on how to contact you by electronic and paper mail.
+
+  If the program does terminal interaction, make it output a short
+notice like this when it starts in an interactive mode:
+
+    <program>  Copyright (C) <year>  <name of author>
+    This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, your program's commands
+might be different; for a GUI interface, you would use an "about box".
+
+  You should also get your employer (if you work as a programmer) or school,
+if any, to sign a "copyright disclaimer" for the program, if necessary.
+For more information on this, and how to apply and follow the GNU GPL, see
+<http://www.gnu.org/licenses/>.
+
+  The GNU General Public License does not permit incorporating your program
+into proprietary programs.  If your program is a subroutine library, you
+may consider it more useful to permit linking proprietary applications with
+the library.  If this is what you want to do, use the GNU Lesser General
+Public License instead of this License.  But first, please read
+<http://www.gnu.org/philosophy/why-not-lgpl.html>.
diff --git a/Configure b/Configure
index 3b2978b..fc3204a 100755
--- a/Configure
+++ b/Configure
@@ -3,6 +3,22 @@
 # This program will configure the makefile for various OSes.
 #
 # Config version 1.1
+
+#
+#   This program is free software: you can redistribute it and/or modify
+#   it under the terms of the GNU General Public License as published by
+#   the Free Software Foundation, either version 3 of the License, or
+#   (at your option) any later version.
+#
+#   This program is distributed in the hope that it will be useful,
+#   but WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+#   GNU General Public License for more details.
+#
+#   You should have received a copy of the GNU General Public License
+#   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+#
+#
 SYS=
 
 # Heading
diff --git a/LICENSE b/LICENSE
deleted file mode 100644
index fc11038..0000000
--- a/LICENSE
+++ /dev/null
@@ -1,56 +0,0 @@
-/*----------------------------------------------------------------------------+
- |                                                                            |
- |       HEYU - a control program for the X10 CM11A serial interface          |
- |                                                                            |
- |         Portions copyright 2002, 2004-2007 Charles W. Sullivan             |
- |     Portions copyright 1996, 1997, 1998, 1999, 2002 Daniel B. Suthers      |
- |                Portions copyright 1986 Larry Campbell                      |
- |                                                                            |
- |  Entire program copyright 2007 Charles W. Sullivan and Daniel B. Suthers   |
- |                      All Rights Reserved                                   |
- |                                                                            |
- |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)  You may not charge money for it.                                      |
- |  2)  You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)  You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
- | As used herein, HEYU is a trademark of Daniel B. Suthers.                  |
- |                                                                            |
- | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
- | SwitchLinc and LampLinc are trademarks of Smarthome, Inc.                  |
- |                                                                            |
- | The authors are not affiliated with either company.                        |
- |                                                                            |
- | Charles W. Sullivan                                                        |
- | Co-author and Maintainer                                                   |
- | Greensboro, North Carolina                                                 |
- | Email ID: cwsulliv01                                                       |
- | Email domain: -at- heyu -dot- org                                          |
- |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
- +----------------------------------------------------------------------------*/
-
diff --git a/Makefile.in b/Makefile.in
index 69011d7..8e9b28b 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -2,6 +2,22 @@
 ## interface.  From this point on the Makefile is copied from Makefile.in
 ## by the Configure program
 
+##
+##   This program is free software: you can redistribute it and/or modify
+##   it under the terms of the GNU General Public License as published by
+##   the Free Software Foundation, either version 3 of the License, or
+##   (at your option) any later version.
+##
+##   This program is distributed in the hope that it will be useful,
+##   but WITHOUT ANY WARRANTY; without even the implied warranty of
+##   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+##   GNU General Public License for more details.
+##
+##   You should have received a copy of the GNU General Public License
+##   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+##
+##
+
 SRCS =	date.c erase.c info.c  message.c relay.c \
 	monitor.c reset.c setclock.c stop.c \
 	tty.c x10.c xread.c xwrite.c status.c cm11a.c \
diff --git a/cm10a.c b/cm10a.c
index 44559da..5b37496 100644
--- a/cm10a.c
+++ b/cm10a.c
@@ -2,23 +2,8 @@
  |                                                                            |
  |              HEYU CM10 "IBM Home Director HD16" Support                    |
  |               Copyright 2006 Charles W. Sullivan                           |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -29,23 +14,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <ctype.h>
diff --git a/cm11a.c b/cm11a.c
index f54482e..87a26b0 100644
--- a/cm11a.c
+++ b/cm11a.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/cm17a.c b/cm17a.c
index da0ea8c..2f1652d 100644
--- a/cm17a.c
+++ b/cm17a.c
@@ -2,23 +2,8 @@
  |                                                                            |
  |                 HEYU CM17A "Firecracker" Support                           |
  |             Copyright 2005, 2006 Charles W. Sullivan                       |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -29,23 +14,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #ifdef HASCM17A  /* Compile only if configured for CM17A */
 
 #include <stdio.h>
diff --git a/cmd.c b/cmd.c
index 0269a2c..a927942 100644
--- a/cmd.c
+++ b/cmd.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |                    Enhanced HEYU Functionality                             |
  |             Copyright 2002-2008 Charles W. Sullivan                        |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <ctype.h>
diff --git a/config.c b/config.c
index af5c0c9..73a0306 100644
--- a/config.c
+++ b/config.c
@@ -2,23 +2,8 @@
  |                                                                            |
  |                       HEYU Configuration                                   |
  |       Copyright 2002,2003,2004-2008 Charles W. Sullivan                    |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -29,23 +14,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <sys/types.h>
diff --git a/date.c b/date.c
index 9c411a0..310e3e9 100644
--- a/date.c
+++ b/date.c
@@ -1,15 +1,7 @@
 
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
@@ -17,6 +9,22 @@
 
  /* Changes for the CM11A made by Daniel Suthers, dbs@tanj.com */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <time.h>
 #include "x10.h"
diff --git a/digimax.c b/digimax.c
index a96343f..7972322 100644
--- a/digimax.c
+++ b/digimax.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |                    Digimax Support for HEYU                                |
  |                Copyright 2008 Charles W. Sullivan                          |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/digimax.h b/digimax.h
index d950d76..b7562a7 100644
--- a/digimax.h
+++ b/digimax.h
@@ -1,3 +1,36 @@
+/*----------------------------------------------------------------------------+
+ |                                                                            |
+ |                    Digimax Support for HEYU                                |
+ |                Copyright 2008 Charles W. Sullivan                          |
+ |                                                                            |
+ |                                                                            |
+ | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
+ | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
+ | The author is not affiliated with either entity.                           |
+ |                                                                            |
+ | Charles W. Sullivan                                                        |
+ | Co-author and Maintainer                                                   |
+ | Greensboro, North Carolina                                                 |
+ | Email ID: cwsulliv01                                                       |
+ | Email domain: -at- heyu -dot- org                                          |
+ |                                                                            |
+ +----------------------------------------------------------------------------*/
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
 
 /* Bitfields for DigiMax 210 */
 
diff --git a/eeprom.c b/eeprom.c
index ede26e1..6f05fff 100644
--- a/eeprom.c
+++ b/eeprom.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/eeprom.h b/eeprom.h
index e40ca94..c143a73 100644
--- a/eeprom.h
+++ b/eeprom.h
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/erase.c b/erase.c
index 479b181..c08eba0 100644
--- a/erase.c
+++ b/erase.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/info.c b/info.c
index a0e953f..36ec8bf 100644
--- a/info.c
+++ b/info.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/install.sh b/install.sh
index 75979ca..f0817ae 100755
--- a/install.sh
+++ b/install.sh
@@ -9,6 +9,22 @@
 # This script also checks for permissions on common files and directories.
 #
 
+#
+#   This program is free software: you can redistribute it and/or modify
+#   it under the terms of the GNU General Public License as published by
+#   the Free Software Foundation, either version 3 of the License, or
+#   (at your option) any later version.
+#
+#   This program is distributed in the hope that it will be useful,
+#   but WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+#   GNU General Public License for more details.
+#
+#   You should have received a copy of the GNU General Public License
+#   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+#
+#
+
 # Who am i?
 ME=`id | sed "s/\(uid=[0-9]*\).*/\1/"`
 if [ $ME = "uid=0" ] ; then
diff --git a/message.c b/message.c
index a79c88e..2c1bb1b 100644
--- a/message.c
+++ b/message.c
@@ -1,14 +1,6 @@
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
@@ -17,6 +9,22 @@
  * updated by Daniel Suthers, dbs@tanj.com 1996 -- 2000 
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include "x10.h"
 
diff --git a/modules.c b/modules.c
index 49ba97e..92683c6 100644
--- a/modules.c
+++ b/modules.c
@@ -4,23 +4,8 @@
  |                                                                            |
  |                  X10 Module Attributes for HEYU                            |
  |             Copyright 2004-2008 Charles W. Sullivan                        |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | SwitchLinc and LampLinc are trademarks of Smarthome, Inc.                  |
@@ -32,23 +17,23 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
 #include <stdio.h>
 #if defined(SYSV) || defined(FREEBSD) || defined(OPENBSD)
 #include <string.h>
diff --git a/monitor.c b/monitor.c
index 666203a..cdf9be6 100644
--- a/monitor.c
+++ b/monitor.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/oregon.c b/oregon.c
index a90e8bd..38c3f60 100644
--- a/oregon.c
+++ b/oregon.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |                  Oregon Sensor Support for HEYU                            |
  |                Copyright 2008 Charles W. Sullivan                          |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 
 
 #include <stdio.h>
diff --git a/oregon.h b/oregon.h
index 9a8d255..4612adb 100644
--- a/oregon.h
+++ b/oregon.h
@@ -1,3 +1,36 @@
+/*----------------------------------------------------------------------------+
+ |                                                                            |
+ |                  Oregon Sensor Support for HEYU                            |
+ |                Copyright 2008 Charles W. Sullivan                          |
+ |                                                                            |
+ |                                                                            |
+ | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
+ | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
+ | The author is not affiliated with either entity.                           |
+ |                                                                            |
+ | Charles W. Sullivan                                                        |
+ | Co-author and Maintainer                                                   |
+ | Greensboro, North Carolina                                                 |
+ | Email ID: cwsulliv01                                                       |
+ | Email domain: -at- heyu -dot- org                                          |
+ |                                                                            |
+ +----------------------------------------------------------------------------*/
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
 
 /* Formats for Oregon data */
 #define  FMT_ORET       "%.1f"  /* Temperature */
diff --git a/poll.c b/poll.c
index 3b808e3..4c71c4e 100644
--- a/poll.c
+++ b/poll.c
@@ -3,7 +3,6 @@
  |                    Enhanced HEYU Functionality                             |
  |                                                                            |
  |         Enhancements copyright 2004-2008 Charles W. Sullivan               |
- |                      All Rights Reserved                                   |
  |                                                                            |
  | Changes for use with CM11A copyright 1996, 1997 Daniel B. Suthers,         |
  | Pleasanton Ca, 94588 USA                                                   |
@@ -14,19 +13,6 @@
  | John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted         |
  | by doing the System V port and adding some nice features.  Thanks!         |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
  |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
@@ -38,23 +24,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <sys/types.h>
 #include <sys/stat.h>
diff --git a/process.c b/process.c
index 03cfa04..fa41be6 100644
--- a/process.c
+++ b/process.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |      Enhanced HEYU Functionality for Uploaded Timers and Macros            |
  |        Copyright 2002,2003,2004,2005,2006 Charles W. Sullivan              |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <ctype.h>
 #include <stdlib.h>
 #include <unistd.h>
diff --git a/process.h b/process.h
index ae758b9..5c7bf95 100644
--- a/process.h
+++ b/process.h
@@ -1,3 +1,36 @@
+/*----------------------------------------------------------------------------+
+ |                                                                            |
+ |      Enhanced HEYU Functionality for Uploaded Timers and Macros            |
+ |        Copyright 2002,2003,2004,2005,2006 Charles W. Sullivan              |
+ |                                                                            |
+ |                                                                            |
+ | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
+ | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
+ | The author is not affiliated with either entity.                           |
+ |                                                                            |
+ | Charles W. Sullivan                                                        |
+ | Co-author and Maintainer                                                   |
+ | Greensboro, North Carolina                                                 |
+ | Email ID: cwsulliv01                                                       |
+ | Email domain: -at- heyu -dot- org                                          |
+ |                                                                            |
+ +----------------------------------------------------------------------------*/
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
 
 #include <sys/types.h>
 #include <sys/stat.h>
diff --git a/relay.c b/relay.c
index a764cb4..45e1c79 100644
--- a/relay.c
+++ b/relay.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/relay_aux.c b/relay_aux.c
index c4bd3ad..d295140 100644
--- a/relay_aux.c
+++ b/relay_aux.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |                  HEYU Auxiliary Input Daemon                               |
  |       Copyright 2002,2003,2004-2007 Charles W. Sullivan                    |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 
 #ifdef SCO
 #define _IBCS2
diff --git a/reset.c b/reset.c
index dd5f179..9d15259 100644
--- a/reset.c
+++ b/reset.c
@@ -1,14 +1,6 @@
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
@@ -18,6 +10,22 @@
  *
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <ctype.h>
 #include <stdio.h>
diff --git a/rfxcom.c b/rfxcom.c
index 7babd78..8c704c8 100644
--- a/rfxcom.c
+++ b/rfxcom.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |              RFXSensor and RFXMeter Support for HEYU                       |
  |                Copyright 2008 Charles W. Sullivan                          |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 
 
 #include <stdio.h>
diff --git a/rfxcom.h b/rfxcom.h
index 3112c85..17c923c 100644
--- a/rfxcom.h
+++ b/rfxcom.h
@@ -1,3 +1,36 @@
+/*----------------------------------------------------------------------------+
+ |                                                                            |
+ |              RFXSensor and RFXMeter Support for HEYU                       |
+ |                Copyright 2008 Charles W. Sullivan                          |
+ |                                                                            |
+ |                                                                            |
+ | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
+ | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
+ | The author is not affiliated with either entity.                           |
+ |                                                                            |
+ | Charles W. Sullivan                                                        |
+ | Co-author and Maintainer                                                   |
+ | Greensboro, North Carolina                                                 |
+ | Email ID: cwsulliv01                                                       |
+ | Email domain: -at- heyu -dot- org                                          |
+ |                                                                            |
+ +----------------------------------------------------------------------------*/
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
 
 
 /* Formats for displayed values of RFXSensor variables */
diff --git a/setclock.c b/setclock.c
index ecf01a5..d505a43 100644
--- a/setclock.c
+++ b/setclock.c
@@ -3,16 +3,6 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
- *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
- *
  */
 
 /*
@@ -24,6 +14,22 @@
  * Code modified for Heyu ver 2 by Charles Sullivan 
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <sys/types.h>
 #include <time.h>
diff --git a/status.c b/status.c
index 39ac8ef..a70c41d 100644
--- a/status.c
+++ b/status.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/stop.c b/stop.c
index 161db82..3ab7b5e 100644
--- a/stop.c
+++ b/stop.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
diff --git a/sun.c b/sun.c
index 08c0dcf..d7b82ab 100644
--- a/sun.c
+++ b/sun.c
@@ -7,6 +7,22 @@
  | Page 84.                                                                   |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
diff --git a/sun.h b/sun.h
index 577aa58..a8c6029 100644
--- a/sun.h
+++ b/sun.h
@@ -1,3 +1,27 @@
+/*----------------------------------------------------------------------------+
+ | Sunrise/Sunset functions for Heyu.                                         |
+ |                                                                            |
+ | The solar computation functions below were programmed by Charles W.        |
+ | Sullivan utilizing the techniques and astronomical constants published by  |
+ | Roger W. Sinnott in the August 1994 issue of Sky & Telescope Magazine,     |
+ | Page 84.                                                                   |
+ +----------------------------------------------------------------------------*/
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
 
 /* Return codes for function suntimes() */
 #define NORMAL_SUN    0
diff --git a/timing.c b/timing.c
index 81e1f86..c050030 100644
--- a/timing.c
+++ b/timing.c
@@ -2,23 +2,8 @@
  |                                                                            |
  |                   HEYU Timing Loop Support                                 |
  |               Copyright 2005 Charles W. Sullivan                           |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -29,23 +14,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 
 #include <time.h>
 #include <unistd.h>
diff --git a/tty.c b/tty.c
index c7aa6f3..b26d965 100644
--- a/tty.c
+++ b/tty.c
@@ -4,34 +4,32 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
- *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
- *
  */
 
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #ifdef        SCO
 #define       _IBCS2
 #endif
diff --git a/tty_aux.c b/tty_aux.c
index 1e5881e..63389e5 100644
--- a/tty_aux.c
+++ b/tty_aux.c
@@ -4,34 +4,32 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
- *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
- *
  */
 
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #ifdef        SCO
 #define       _IBCS2
 #endif
diff --git a/version.h b/version.h
index dd500e5..f60495e 100644
--- a/version.h
+++ b/version.h
@@ -1,3 +1,19 @@
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 /* This file tracks the version of the heyu program
  * It should be manually changed when the version number is ready to be
  * bumped up.
diff --git a/x10.c b/x10.c
index b82e862..09c3c16 100644
--- a/x10.c
+++ b/x10.c
@@ -5,21 +5,29 @@
  */
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
  * 
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <sys/stat.h>
 #include <unistd.h>
diff --git a/x10.h b/x10.h
index 724dde6..c5f5ef2 100644
--- a/x10.h
+++ b/x10.h
@@ -2,25 +2,33 @@
  * Changes for use with CM11A copyright 1996, 1997 Daniel B. Suthers,
  * Pleasanton Ca, 94588 USA
  * E-mail dbs@tanj.com
- * Same permissions and restrictions as below.
+ *
  */
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
  */
 
 /*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
+/*
  * X-10 CM11 Computer Interface Definitions
  */
 
diff --git a/x10aux.c b/x10aux.c
index 1158f1d..4678e31 100644
--- a/x10aux.c
+++ b/x10aux.c
@@ -3,23 +3,8 @@
  |                                                                            |
  |                RF Auxiliary Input Support for HEYU                         |
  |              Copyright 2006, 2008 Charles W. Sullivan                      |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -30,23 +15,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
diff --git a/x10state.c b/x10state.c
index d0ae640..ede0924 100644
--- a/x10state.c
+++ b/x10state.c
@@ -2,23 +2,8 @@
  |                                                                            |
  |              State and Script functions for HEYU                           |
  |            Copyright 2004-2010 Charles W. Sullivan                         |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -29,23 +14,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <unistd.h>
diff --git a/x10state.h b/x10state.h
index d6d4a76..de0caae 100644
--- a/x10state.h
+++ b/x10state.h
@@ -1,3 +1,36 @@
+/*----------------------------------------------------------------------------+
+ |                                                                            |
+ |              State and Script functions for HEYU                           |
+ |            Copyright 2004-2010 Charles W. Sullivan                         |
+ |                                                                            |
+ |                                                                            |
+ | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
+ | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
+ | The author is not affiliated with either entity.                           |
+ |                                                                            |
+ | Charles W. Sullivan                                                        |
+ | Co-author and Maintainer                                                   |
+ | Greensboro, North Carolina                                                 |
+ | Email ID: cwsulliv01                                                       |
+ | Email domain: -at- heyu -dot- org                                          |
+ |                                                                            |
+ +----------------------------------------------------------------------------*/
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
 
 
 
diff --git a/xread.c b/xread.c
index dfc3ced..d46e51d 100644
--- a/xread.c
+++ b/xread.c
@@ -2,25 +2,33 @@
  * Changes for use with CM11A copyright 1996, 1997 - 2003 Daniel B. Suthers,
  * Pleasanton Ca, 94588 USA
  * E-mail dbs@tanj.com
- * Subject to the same permissions and restrictions as below.
+ *
  */
 
 /*
  * Copyright 1986 by Larry Campbell, 73 Concord Street, Maynard MA 01754 USA
- * (maynard!campbell).  You may freely copy, use, and distribute this software
- * subject to the following restrictions:
- *
- *  1)	You may not charge money for it.
- *  2)	You may not remove or alter this copyright notice.
- *  3)	You may not claim you wrote it.
- *  4)	If you make improvements (or other changes), you are requested
- *	to send them to me, so there's a focal point for distributing
- *	improved versions.
+ * (maynard!campbell).
  *
  * John Chmielewski (tesla!jlc until 9/1/86, then rogue!jlc) assisted
  * by doing the System V port and adding some nice features.  Thanks!
  */
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <signal.h>
diff --git a/xsync.c b/xsync.c
index 7619580..c4924f5 100644
--- a/xsync.c
+++ b/xsync.c
@@ -2,23 +2,8 @@
  |                                                                            |
  |            HEYU Support for External Power Line Sync                       |
  |             Copyright 2005,2006 Charles W. Sullivan                        |
- |                      All Rights Reserved                                   |
  |                                                                            |
  |                                                                            |
- | This software is licensed free of charge for non-commercial distribution   |
- | and for personal and internal business use only.  Inclusion of this        |
- | software or any part thereof in a commercial product is prohibited         |
- | without the prior written permission of the author.  You may copy, use,    |
- | and distribute this software subject to the following restrictions:        |
- |                                                                            |
- |  1)	You may not charge money for it.                                      |
- |  2)	You may not remove or alter this license, copyright notice, or the    |
- |      included disclaimers.                                                 |
- |  3)	You may not claim you wrote it.                                       |
- |  4)	If you make improvements (or other changes), you are requested        |
- |	to send them to the Heyu maintainer so there's a focal point for      |
- |      distributing improved versions.                                       |
- |                                                                            |
  | As used herein, HEYU is a trademark of Daniel B. Suthers.                  | 
  | X10, CM11A, and ActiveHome are trademarks of X-10 (USA) Inc.               |
  | The author is not affiliated with either entity.                           |
@@ -29,23 +14,24 @@
  | Email ID: cwsulliv01                                                       |
  | Email domain: -at- heyu -dot- org                                          |
  |                                                                            |
- | Disclaimers:                                                               |
- | THERE IS NO ASSURANCE THAT THIS SOFTWARE IS FREE OF DEFECTS AND IT MUST    |
- | NOT BE USED IN ANY SITUATION WHERE THERE IS ANY CHANCE THAT ITS            |
- | PERFORMANCE OR FAILURE TO PERFORM AS EXPECTED COULD RESULT IN LOSS OF      |
- | LIFE, INJURY TO PERSONS OR PROPERTY, FINANCIAL LOSS, OR LEGAL LIABILITY.   |
- |                                                                            |
- | TO THE EXTENT ALLOWED BY APPLICABLE LAW, THIS SOFTWARE IS PROVIDED "AS IS",|
- | WITH NO EXPRESS OR IMPLIED WARRANTY, INCLUDING, BUT NOT LIMITED TO, THE    |
- | IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.|
- |                                                                            |
- | IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW WILL THE AUTHOR BE LIABLE    |
- | FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL   |
- | DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE EVEN IF   |
- | THE AUTHOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.            |
- |                                                                            |
  +----------------------------------------------------------------------------*/
 
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
+ *
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
 
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/xwrite.c b/xwrite.c
index 5221b3c..e4ef8c0 100644
--- a/xwrite.c
+++ b/xwrite.c
@@ -3,15 +3,21 @@
  * Pleasanton Ca. 94588 USA
  * E-MAIL dbs@tanj.com
  *
- * You may freely copy, use, and distribute this software,
- * in whole or in part, subject to the following restrictions:
+ */
+
+/*
+ *   This program is free software: you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, either version 3 of the License, or
+ *   (at your option) any later version.
+ *
+ *   This program is distributed in the hope that it will be useful,
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *   GNU General Public License for more details.
  *
- *  1)  You may not charge money for it.
- *  2)  You may not remove or alter this copyright notice.
- *  3)  You may not claim you wrote it.
- *  4)  If you make improvements (or other changes), you are requested
- *      to send them to me, so there's a focal point for distributing
- *      improved versions.
+ *   You should have received a copy of the GNU General Public License
+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 

commit 3a4a3d3b57a5ec57f828f736c5ac9ac5084da91d
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Thu Nov 17 23:48:15 2011 +0100

    Fix find_lockup_scripts() function definition mismatch
    
    The find_lockup_scripts() function is defined as taking one argument
    of type unsigned char, while it actually doesn't make any use of that
    argument, and is declared and used in poll.c as taking no arguments.
    Fix the definition to match the usage.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/x10state.c b/x10state.c
index 10fe611..d0ae640 100644
--- a/x10state.c
+++ b/x10state.c
@@ -4327,7 +4327,7 @@ int find_rfxjam_scripts ( void )
 /*---------------------------------------------------------------------+
  | Launch -lockup scripts which match the launch conditions.           |
  +---------------------------------------------------------------------*/
-int find_lockup_scripts ( unsigned char bootflag )
+int find_lockup_scripts(void)
 {
    LAUNCHER      *launcherp;
    int           j, launchp = -1;

commit bc5d2b3dafeaec8c5769e8aa8d19bf72d228bbbf
Merge: 56a8969 3cb9649
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sat Nov 19 00:21:17 2011 +0100

    Heyu 2.10-rc3
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

commit 3cb9649d84e0f53ad68b1f5a90e1a0ed234c5740
Merge: 9407f55 055aca8
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sat Nov 19 00:15:24 2011 +0100

    Merge branch 'fixes' into for-next
    
    * fixes:
      Fix argument type passed from check4poll() to set_counter()

commit 9407f55872d55fa3b093e9ac11c6b9596bca074c
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sat Nov 5 22:05:33 2011 +0100

    Engine: don't handle checksums when processing RF signals
    
    Commit 2cd54bdeb9, "Engine: use chksum_alert for all CM11 commands",
    introduced a mechanism for calculating checksums of all commands
    destined to a power line interface and passing them to the procedure
    that reads data back from that interface, in order to detect and ignore
    all checksum responses instead of reporting them as unknown values.
    However, that change didn't take into account that the code path which
    handled outgoing power line commands was also used for processing of
    X10 Standard RF signals obtained from an AUX interface even if not
    retransmitted over the power line. As a consequence, it may happen that
    an excessively stored checksum of an incoming RF signal will match an
    arbitrary byte of data read from the power line interface, resulting in
    temporary misinterpretation of the incoming data stream. Fix it.
    
    Created against heyu-2.10-rc2.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index deba48d..9af30db 100644
--- a/poll.c
+++ b/poll.c
@@ -399,7 +399,8 @@ int check4poll( int showdata, int timeout )
                       /* An address */
                       if ( *(transp = translate_sent(buf, n, &launchp)) )
                          fprintf(fdsout, "%s %s %s\n", datstrf(), send_prefix, transp);
-		      chksum_alert = chksum;
+                      if (signal_source != RCVA)
+                         chksum_alert = chksum;
                       if ( launchp >= 0 && i_am_state) {
                          launch_scripts(&launchp);
                       }
@@ -408,7 +409,8 @@ int check4poll( int showdata, int timeout )
                       /* Standard function */
                       if ( *(transp = translate_sent(buf, n, &launchp)) )
                          fprintf(fdsout, "%s %s %s\n", datstrf(), send_prefix, transp);
-		      chksum_alert = chksum;
+                      if (signal_source != RCVA)
+                         chksum_alert = chksum;
                       if ( launchp >= 0 && i_am_state) {
                          launch_scripts(&launchp);
                       }

commit 78255ad320f64367c3c971dc4efb8f2c482cb9e0
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Fri Nov 18 22:46:57 2011 +0100

    Attempt to fix Visonic support
    
    It looks like support for Visonic sensor signals received over a
    compatible RFXCOM interface, still implemented by Charles, may be in
    a more complete shape than it is exhibited in current Heyu releases,
    implemented only for a new, not yet used, dual receiver feature related
    code path. This patch simply updates the old code path, still active by
    default, to use the same Visonic processing pattern as the new one.
    
    Not tested, since I have neither Visonic sensors nor RFXCOM Visonic
    receiver available, and received no feedback from users so far. Applied
    in hope it will be verified as soon as the next release candidate is
    published.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/x10aux.c b/x10aux.c
index ddadc93..1158f1d 100644
--- a/x10aux.c
+++ b/x10aux.c
@@ -1626,7 +1626,6 @@ int aux_rfxcomvl ( void )
          }
          else if ( *type == RF_VISONIC ) {
             if ( *count == *mincount )
-//               forward_variable_aux_data(*type, xbuff, *bufflen + 1);
                send_virtual_aux_data(0, buff[2], *type, buff[0], buff[1], buff[4], 0);
          }
          else if ( *type == RF_SEC || *type == RF_ENT || *type == RF_XJAM ) {
@@ -1698,7 +1697,6 @@ int aux_rfxcomvl ( void )
                send_virtual_aux_data(0, buff[2], RF_SEC, buff[0], buff[4], 0, 0);
             }
             else if ( *type == RF_VISONIC ) {
-//               forward_variable_aux_data(*type, xbuff, *bufflen + 1);
                send_virtual_aux_data(0, buff[2], *type, buff[0], buff[1], buff[4], 0);
             }
 
@@ -2103,7 +2101,7 @@ int aux_rfxcomvl ( void )
          }
          else if ( type == RF_VISONIC ) {
             if ( count == mincount )
-               forward_variable_aux_data(type, xbuff, bufflen + 1);
+               send_virtual_aux_data(0, buff[2], type, buff[0], buff[1], buff[4], 0);
          }
          else if ( type == RF_DIGIMAX ) {
             if ( count == mincount ) {
@@ -2167,7 +2165,7 @@ int aux_rfxcomvl ( void )
                forward_variable_aux_data(RF_KAKU, xbuff, bufflen + 1);
             }
             else if ( type == RF_VISONIC ) {
-               forward_variable_aux_data(type, xbuff, bufflen + 1);
+               send_virtual_aux_data(0, buff[2], type, buff[0], buff[1], buff[4], 0);
             }
             else if ( type == RF_DIGIMAX ) {
                forward_digimax(buff);

commit 055aca85357814bea252d56504507faf1308f3e4
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Mon Nov 7 00:58:12 2011 +0100

    Fix argument type passed from check4poll() to set_counter()
    
    Otherwise, counters from the range of 0 to 255 might be overwritten
    unintentionally in place of those with higher numbers if Heyu was
    configured and built with support for more than 256 user counters.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index b47a40c..fff5737 100644
--- a/poll.c
+++ b/poll.c
@@ -189,7 +189,7 @@ int check4poll( int showdata, int timeout )
     extern char *translate_rfxtype_message ( unsigned char * );
     extern char *translate_rfxsensor_ident ( unsigned char * );
     extern char *display_variable_aux_data ( unsigned char * );
-    extern int set_counter ( unsigned char, unsigned short, unsigned char );
+    extern int set_counter ( int, unsigned short, unsigned char );
     extern char *translate_counter_action ( unsigned char * );
     extern char *translate_kaku ( unsigned char *, unsigned char *, int * );
     extern char *translate_visonic ( unsigned char *, unsigned char *, int * );

commit aeebd71e1377ce2403e60f6ea2c3ec49425b5182
Merge: 2fc9930 7d6e105
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Sep 18 17:01:42 2011 +0200

    Merge branch 'fixes' into for-next
    
    * fixes:
      Fix oreBP related environment variables creation bug
      Fix broken handling of X10 Security RF parity bit

commit 2fc9930c9ba8a86e366ecdaf6a28658f3cc8bbbf
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue Aug 30 17:28:29 2011 +0200

    Enhance recognition of X10 Standard RF same signal bursts
    
    I've discovered an oddity in RFXCOM data processing which results in
    random X10 Standard RF signals happening to be reported more than once.
    After more thorough investigation I've found that single X10 Standard
    RF bursts can happen to be decoded and reported by the RFXCOM receiver
    working in default (variable length) mode in a slightly different way
    than other bursts of the same signal. This may be caused by noise, but
    I suspect this may also have something to do with new RFXCOM firmware,
    capable of decoding still more and more signal types, which may lead to
    less restrictive noise filtering.
    
    The contents of such distorted bursts is still correct, but they are
    reported to Heyu as being longer than others by 1 bit. While Heyu still
    recognises them as valid X10 Standard RF transmissions, comparing them
    with other bursts by their length fails, which results in reporting
    them as separate signals. If compared by their type and standard length
    contents instead, they no longer cause multi-burst series being broken
    into separate signals.
    
    I've implemented this fix for both current shared RFXCOM receive queue
    and a work in progress separate master/slave receive queues code paths.
    
    This patch replaces the reverted commit a65f3b9a1a0f.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/x10aux.c b/x10aux.c
index 9546400..9c87f31 100644
--- a/x10aux.c
+++ b/x10aux.c
@@ -1672,7 +1672,9 @@ int aux_rfxcomvl ( void )
             send_virtual_aux_data(0, buff[0], *type, buff[1], 0, buff[2], buff[3]);
          }
       }
-      else if ( *bufflen == *lastlen && memcmp(buff, lastbuff, *bufflen) == 0 ) {
+      else if ((*bufflen == *lastlen ||
+              (*type == RF_STD && (*lastlen == 4 || (*lastlen = *bufflen) == 4))
+                                  ) && memcmp(buff, lastbuff, *lastlen) == 0 ) {
          /* Repeat of previous burst */
          (*count)++;
          nread = 0;
@@ -2123,7 +2125,9 @@ int aux_rfxcomvl ( void )
             send_virtual_aux_data(0, buff[0], type, buff[1], 0, buff[2], buff[3]);
          }
       }
-      else if ( /*this_word == rfword */ bufflen == lastlen && memcmp(buff, lastbuff, bufflen) == 0 ) {
+      else if ((bufflen == lastlen ||
+                (type == RF_STD && (lastlen == 4 || (lastlen = bufflen) == 4))
+                                    ) && memcmp(buff, lastbuff, lastlen) == 0) {
          /* Repeat of previous burst */
          count++;
          nread = 0;

commit 8964e29c027e519777f04769a980ebd4ba3fb903
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Mon Aug 29 23:31:07 2011 +0200

    Revert "Compare RFXCOM X10 signal bursts by type, not by length"
    
    This reverts commit a65f3b9a1a0fbad599f4b528a0f6ddce2f4f10be.
    
    While working on Oregon radio clocks support, it occurred that still
    more advances methods of suppressing repeated bursts of same signals
    have to be invented.  Instead of implementing them on top of the
    recently relaxed check for signals similarity, revert back to the
    previous, more strict method, with the intention of further extending
    it with case specific exceptions.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/x10aux.c b/x10aux.c
index 26a3cc1..9546400 100644
--- a/x10aux.c
+++ b/x10aux.c
@@ -1249,8 +1249,8 @@ int aux_rfxcomvl ( void )
    unsigned char  subindx, subtype;
    unsigned char  hcode, ucode, fcode, rfflood, addr, xmtr, rcvr;
 
-   unsigned char  typeq[2], lasttypeq[2], nbitsq[2], trulenq[2];
-   unsigned char  *type, *lasttype, *nbits, *trulen;
+   unsigned char  typeq[2], nbitsq[2], trulenq[2];
+   unsigned char  *type, *nbits, *trulen;
 
    unsigned char  xbuffq[2][64];
    unsigned char  *xbuff, *buff;
@@ -1309,7 +1309,6 @@ int aux_rfxcomvl ( void )
    countq[0] = countq[1] = 0;
    lastlenq[0] = lastlenq[1] = -1;
    typeq[0] = typeq[1] = 0;
-   lasttypeq[0] = lasttypeq[1] = 0;
    subindx = 0;
    trulenq[0] = trulenq[1] = 0;
    nseqq[0] = nseqq[1] = 0;
@@ -1374,7 +1373,6 @@ int aux_rfxcomvl ( void )
       bufflen = &bufflenq[rcvr];
       nbits = &nbitsq[rcvr];
       type = &typeq[rcvr];
-      lasttype = &lasttypeq[rcvr];
       sensor_flag = &sensor_flagq[rcvr];
       use_old_buffer = &use_old_bufferq[rcvr];
       saddr = &saddrq[rcvr];
@@ -1603,7 +1601,6 @@ int aux_rfxcomvl ( void )
       *use_old_buffer = 0;
 
       if ( *count == 0 ) {
-	 *lasttype = *type;
          memcpy(lastbuff, buff, *bufflen);
          *lastlen = *bufflen;
          (*count)++;
@@ -1675,7 +1672,7 @@ int aux_rfxcomvl ( void )
             send_virtual_aux_data(0, buff[0], *type, buff[1], 0, buff[2], buff[3]);
          }
       }
-      else if ( *type == *lasttype && memcmp(buff, lastbuff, *bufflen < *lastlen ? *bufflen : *lastlen) == 0 ) {
+      else if ( *bufflen == *lastlen && memcmp(buff, lastbuff, *bufflen) == 0 ) {
          /* Repeat of previous burst */
          (*count)++;
          nread = 0;
@@ -1749,7 +1746,7 @@ int aux_rfxcomvl ( void )
  +-------------------------------------------------------------*/
 int aux_rfxcomvl ( void )
 {
-   unsigned char  type, lasttype, subindx, subtype, trulen;
+   unsigned char  type, subindx, subtype, trulen;
    unsigned char  hcode, ucode, fcode, rfflood, nbits, addr, xmtr, rcvr;
    unsigned char  xbuff[64], *buff;
    unsigned char  lastbuff[64];
@@ -1781,7 +1778,6 @@ int aux_rfxcomvl ( void )
 
    lastlen = -1;
    type = 0;
-   lasttype = 0;
    subindx = 0;
    trulen = 0;
    nseq = 0;
@@ -2057,7 +2053,6 @@ int aux_rfxcomvl ( void )
       use_old_buffer = 0;
 
       if ( count == 0 ) {
-         lasttype = type;
          memcpy(lastbuff, buff, bufflen);
          lastlen = bufflen;
          count++;
@@ -2128,7 +2123,7 @@ int aux_rfxcomvl ( void )
             send_virtual_aux_data(0, buff[0], type, buff[1], 0, buff[2], buff[3]);
          }
       }
-      else if ( /*this_word == rfword */ type == lasttype && memcmp(buff, lastbuff, bufflen < lastlen ? bufflen : lastlen ) == 0 ) {
+      else if ( /*this_word == rfword */ bufflen == lastlen && memcmp(buff, lastbuff, bufflen) == 0 ) {
          /* Repeat of previous burst */
          count++;
          nread = 0;

commit 2bf41f0dd4fff529b8a3550c266726ed91de3bdf
Merge: 56a8969 cd8e536
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Wed Aug 31 23:39:42 2011 +0200

    Merge branch 'fixes' into for-next
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

commit 56a8969c877d2c449573141bf4b83a271120eb7a
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 7 12:37:53 2011 +0200

    Heyu 2.10-rc2
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/version.h b/version.h
index 1ac799c..dd500e5 100644
--- a/version.h
+++ b/version.h
@@ -2,5 +2,5 @@
  * It should be manually changed when the version number is ready to be
  * bumped up.
  */
-#define VERSION "2.10-rc1"
-#define RELEASE_DATE "20110227"
+#define VERSION "2.10-rc2"
+#define RELEASE_DATE "20110807"

commit 55c653c93ab1ae0d6d11f76a29e7d16f1cf87114
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 7 12:42:11 2011 +0200

    Update RCS related Heyu documentation bits
    
    RCS support in Heyu has been extended by [[revision:187d0e4c33]]
    without manual page being updated. Fix this.
    
    Fixes #5
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/heyu.1 b/heyu.1
index 7fef25a..92ce89d 100644
--- a/heyu.1
+++ b/heyu.1
@@ -1527,11 +1527,18 @@ the following commands (for a thermostat configured for housecode A):
    heyu rcs_req preset A5 5  (setback mode)
 .br
    heyu rcs_req preset A5 6  (setback delta temperature)
+.br
+   heyu rcs_req preset A5 7  (outdoor temperature)
+.br
+   heyu rcs_req preset A5 8  (heat setpoint temperature)
+.br
+   heyu rcs_req preset A5 9  (cooling setpoint temperature)
 
 .PP
 Note: the temperature value stored at the unit 0
 address location will be the one most recently decoded, whether
-(room) temperature, setpoint temperature, or setback delta.
+(room) temperature, setpoint temperature, setback delta, outdoor,
+heat setpoint or cooling setpoint.
 
 .PP
 See the TX15-B or TXB16 protocol manual for complete details.

commit acb1dd15dd3fcb913c929b4bea96edd544f6151a
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 7 12:39:24 2011 +0200

    Prevent from checksums being incorrectly recognised as events
    
    It may happen that a checksum value can match one of special bytes used
    by the CM11A interface to signal events to the user. Since commit
    2cd54bdeb9, "Engine: use chksum_alert for all CM11 commands", some of
    these values may be never recognized as checksums, resulting in the
    engine incorrectly interpreting the data stream.
    
    Fix this issue by moving checksum matching in front of any other
    matching of bytes received.
    
    Fixes #10
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index 2fdb5cf..deba48d 100644
--- a/poll.c
+++ b/poll.c
@@ -601,6 +601,22 @@ int check4poll( int showdata, int timeout )
 	    wasflag = 0;
 	}
 	    
+        if ( buf[0] == chksum_alert ) {
+	    /* this is the checksum expected, just drop it */
+            chksum_alert = -1;
+	    return 0;
+        }
+
+	if (chksum_alert >= 0) {
+	    /* 
+	     * Instead of the checksum expected, we've received something else.
+	     * Don't expect that checksum to appear any longer. Either the
+	     * interface didn't respond with a checksum, busy with an incomming
+	     * transmission or a macro, or we are completely out of sync.
+	     */
+	    chksum_alert = -1;
+	}
+
 	macro_report = 0;
         if ( buf[0] == 0x5a )  {
             /* CM11A has polling info for me */
@@ -615,17 +631,9 @@ int check4poll( int showdata, int timeout )
                 /* We have a byte count */
 	        to_read = buf[0];	/* number of bytes to read */
 		if ( to_read == 0x5a ) {
-                    if ( chksum_alert >= 0 ) {
-                       /* It's the checksum for a sent block of data with checksum = 0x5a */
-                       chksum_alert = -1;
-                       /* fclose(fdsout); */
-                       return 0;
-                    }
-                    else {	
-                       /* Darn.  Another polling indicator */
-		       timeout = 2;
-		       return ( check4poll(showdata, timeout) );
-                    }
+                    /* Darn.  Another polling indicator */
+		    timeout = 2;
+		    return ( check4poll(showdata, timeout) );
 		}
 		else if ( to_read == 0x5b )  { /* Macro report coming in */
 		    to_read = 2;
@@ -1147,9 +1155,6 @@ int check4poll( int showdata, int timeout )
 	else if ( buf[0] == ((configp->ring_ctrl == DISABLE) ? 0xdb : 0xeb) && waitflag ) {
 	   waitflag = 0;
 	}
-        else if ( buf[0] == chksum_alert ) {
-            chksum_alert = -1;
-        }
 	else if ( !(buf[0] == 0x55 && n == 1) )  {
             /* There's some sort of timing problem with the 0x55 ("ready to  */
             /* receive") signal from the interface after a long bright/dim   */

commit 26e01ea051326de7134dffd9cf5532a8862e316d
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Jul 31 00:44:49 2011 +0200

    Fix single 0xff checksum processing
    
    Since 0xff bytes found in the spool file are first tried to be collected
    to a potential triple 0xff seqence, a 0xff checksum is never passed like
    other values to the input parsing procedure, but ends up being indicated
    with the non-zero was flag. Then, it must be processed applying any
    common checksum detection rules, otherwise single bytes following every
    0xff checksum may always get missed.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index ab54a26..2fdb5cf 100644
--- a/poll.c
+++ b/poll.c
@@ -588,6 +588,11 @@ int check4poll( int showdata, int timeout )
 
 	/* print out the saved 0xff from the buffer */
 	if ( buf[0] != 0xff && wasflag > 0 )  {
+	    if (chksum_alert == 0xff) {
+	    	/* a single 0xff was apparently a checksum */
+		chksum_alert = -1;
+		wasflag--;
+	    }
 	    n = buf[0];
 	    for(i = 0; i < wasflag;i++)
 		buf[i] = 0xff;

commit 95666c42c1b5da725227b5cc7d36cfd72f6ab755
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sat Jul 30 23:52:38 2011 +0200

    Fix 0xff checksum before triple 0xff mark case
    
    It may happen that a checksum of the 0xff value is received from the
    CM11A just before a triple 0xff sequence indicating an outgoing command
    or an RF signal or whatever else is appended to the spool file. In this
    rare case, the fourth 0xff detected is treated as incorrect sequence
    length, resulting in the whole sequence being miss-interpreted and the
    just missed checksum still expected to be catched.
    
    Detect this condition and process correctly, invalidating the expected
    checksum value and processing the remaining triple 0xff initiated
    sequence.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index 55b19f8..ab54a26 100644
--- a/poll.c
+++ b/poll.c
@@ -272,6 +272,16 @@ int check4poll( int showdata, int timeout )
 		if( n != 1 ) {
 		     return(0);
                 }
+                if ( buf[0] == 0xff && chksum_alert == 0xff ) {
+		   /*
+		    * We have received four 0xff bytes in a row,
+		    * looks like the first one was the checksum expected,
+		    * so drop one of them and loop one more time.
+		    */
+		   chksum_alert = -1;
+		   wasflag = 2;
+		   continue;
+		}
 		n = buf[0];
 
                 if ( n < 127 ) {

commit 41725e5abbc04a36a4a3c18ebd20c17ea7e71325
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Thu Jul 7 19:50:06 2011 +0200

    Use a negative value for no checksum alert
    
    Originally used only for recognising 0x5a checksums from 0x5a poll
    requests, the chksum_alert variable initial value of 0 had been chosen
    as no checksum (0x5a) expected indication. However, since commit
    2cd54bdeb989c8f39ea6a96a6d2706bf88811ed5, "Engine: use chksum_alert for
    all CM11 commands", this is no longer true. The variable can happen to
    be filled with a legal checksum value of 0 as well, which could result
    in misinterpretation of the spool data stream and still end up with the
    infamous "Poll received unknown value ..." message.
    
    Since the chksum_alert is already declared as a signed integer, use
    a negative value for indicating no checksum expected instead of 0.
    
    Created against Heyu 2.10-rc1.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index 69a2cc9..55b19f8 100644
--- a/poll.c
+++ b/poll.c
@@ -201,7 +201,7 @@ int check4poll( int showdata, int timeout )
     unsigned int squelch;
     unsigned char hcode;
 
-    static int chksum_alert;
+    static int chksum_alert = -1;
     extern char *funclabel[18];
     static unsigned char newbuf[8], hexaddr = 0; 
     static char *send_prefix = "sndc";
@@ -600,9 +600,9 @@ int check4poll( int showdata, int timeout )
                 /* We have a byte count */
 	        to_read = buf[0];	/* number of bytes to read */
 		if ( to_read == 0x5a ) {
-                    if ( chksum_alert ) {
+                    if ( chksum_alert >= 0 ) {
                        /* It's the checksum for a sent block of data with checksum = 0x5a */
-                       chksum_alert = 0;
+                       chksum_alert = -1;
                        /* fclose(fdsout); */
                        return 0;
                     }
@@ -1132,8 +1132,8 @@ int check4poll( int showdata, int timeout )
 	else if ( buf[0] == ((configp->ring_ctrl == DISABLE) ? 0xdb : 0xeb) && waitflag ) {
 	   waitflag = 0;
 	}
-        else if ( buf[0] == chksum_alert && chksum_alert ) {
-            chksum_alert = 0;
+        else if ( buf[0] == chksum_alert ) {
+            chksum_alert = -1;
         }
 	else if ( !(buf[0] == 0x55 && n == 1) )  {
             /* There's some sort of timing problem with the 0x55 ("ready to  */

commit 617e58f1fc4e1a4c2d24b0fa42fc38905a34a6c8
Merge: a65f3b9 cad8440
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sat Aug 6 00:45:22 2011 +0200

    Merge branch 'fixes' into for-next
    
    Conflicts:
    	monitor.c
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

commit a65f3b9a1a0fbad599f4b528a0f6ddce2f4f10be
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue Jul 12 03:03:10 2011 +0200

    Compare RFXCOM X10 signal bursts by type, not by length
    
    I've discovered an oddity in RFXCOM data processing which results in
    random X10 RF signals happening to be reported more than once. After
    more thorough investigation I've found that single X10 RF bursts can
    happen to be decoded and reported by the RFXCOM receiver in a slightly
    different way than other bursts of the same signal. This can be caused
    by noise, but I suspect this may also have something to do with new
    RFXCOM firmware, capable of decoding still more and more signal types,
    which may lead to less restrictive noise filtering.
    
    The content of such distorted bursts is still correct, but they are
    reported to Heyu as being longer than others by 1 bit. While Heyu still
    recognises them as valid X10 RF transmissions, comparing them with other
    bursts by their length fails, which results in reporting them as
    separate signals. If compared by their type instead, they no longer
    cause multi-bursts series being broken into separate signals.
    
    I've implemented this fix for both current shared receive queue, and
    a work in progress separate receive queues code paths.
    
    Created and tested against Heyu 2.9.3.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/x10aux.c b/x10aux.c
index 9546400..26a3cc1 100644
--- a/x10aux.c
+++ b/x10aux.c
@@ -1249,8 +1249,8 @@ int aux_rfxcomvl ( void )
    unsigned char  subindx, subtype;
    unsigned char  hcode, ucode, fcode, rfflood, addr, xmtr, rcvr;
 
-   unsigned char  typeq[2], nbitsq[2], trulenq[2];
-   unsigned char  *type, *nbits, *trulen;
+   unsigned char  typeq[2], lasttypeq[2], nbitsq[2], trulenq[2];
+   unsigned char  *type, *lasttype, *nbits, *trulen;
 
    unsigned char  xbuffq[2][64];
    unsigned char  *xbuff, *buff;
@@ -1309,6 +1309,7 @@ int aux_rfxcomvl ( void )
    countq[0] = countq[1] = 0;
    lastlenq[0] = lastlenq[1] = -1;
    typeq[0] = typeq[1] = 0;
+   lasttypeq[0] = lasttypeq[1] = 0;
    subindx = 0;
    trulenq[0] = trulenq[1] = 0;
    nseqq[0] = nseqq[1] = 0;
@@ -1373,6 +1374,7 @@ int aux_rfxcomvl ( void )
       bufflen = &bufflenq[rcvr];
       nbits = &nbitsq[rcvr];
       type = &typeq[rcvr];
+      lasttype = &lasttypeq[rcvr];
       sensor_flag = &sensor_flagq[rcvr];
       use_old_buffer = &use_old_bufferq[rcvr];
       saddr = &saddrq[rcvr];
@@ -1601,6 +1603,7 @@ int aux_rfxcomvl ( void )
       *use_old_buffer = 0;
 
       if ( *count == 0 ) {
+	 *lasttype = *type;
          memcpy(lastbuff, buff, *bufflen);
          *lastlen = *bufflen;
          (*count)++;
@@ -1672,7 +1675,7 @@ int aux_rfxcomvl ( void )
             send_virtual_aux_data(0, buff[0], *type, buff[1], 0, buff[2], buff[3]);
          }
       }
-      else if ( *bufflen == *lastlen && memcmp(buff, lastbuff, *bufflen) == 0 ) {
+      else if ( *type == *lasttype && memcmp(buff, lastbuff, *bufflen < *lastlen ? *bufflen : *lastlen) == 0 ) {
          /* Repeat of previous burst */
          (*count)++;
          nread = 0;
@@ -1746,7 +1749,7 @@ int aux_rfxcomvl ( void )
  +-------------------------------------------------------------*/
 int aux_rfxcomvl ( void )
 {
-   unsigned char  type, subindx, subtype, trulen;
+   unsigned char  type, lasttype, subindx, subtype, trulen;
    unsigned char  hcode, ucode, fcode, rfflood, nbits, addr, xmtr, rcvr;
    unsigned char  xbuff[64], *buff;
    unsigned char  lastbuff[64];
@@ -1778,6 +1781,7 @@ int aux_rfxcomvl ( void )
 
    lastlen = -1;
    type = 0;
+   lasttype = 0;
    subindx = 0;
    trulen = 0;
    nseq = 0;
@@ -2053,6 +2057,7 @@ int aux_rfxcomvl ( void )
       use_old_buffer = 0;
 
       if ( count == 0 ) {
+         lasttype = type;
          memcpy(lastbuff, buff, bufflen);
          lastlen = bufflen;
          count++;
@@ -2123,7 +2128,7 @@ int aux_rfxcomvl ( void )
             send_virtual_aux_data(0, buff[0], type, buff[1], 0, buff[2], buff[3]);
          }
       }
-      else if ( /*this_word == rfword */ bufflen == lastlen && memcmp(buff, lastbuff, bufflen) == 0 ) {
+      else if ( /*this_word == rfword */ type == lasttype && memcmp(buff, lastbuff, bufflen < lastlen ? bufflen : lastlen ) == 0 ) {
          /* Repeat of previous burst */
          count++;
          nread = 0;

commit d1eaea7cf2085a3bca0225c6b88e463bc7e75352
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Jul 10 19:12:29 2011 +0200

    Completely stop using select() as a *sleep() replacement
    
    It looks like previous changes towards using the locally defined,
    portable microsleep() function instead of select() (commits 716ffb5887,
    "Stop using select() as a *sleep() replacement on linux" and 027db5f4cd,
    "Use microsleep(ENGINE_POLL) instead of sleep(1)") have been confirmed
    working correctly on Linux. I expect microsleep() doing its job
    correctly on other platforms as well, so decided to completely get rid
    of that hardly legal use of select().
    
    Created against Heyu 2.10-rc1.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/cm17a.c b/cm17a.c
index 9cd973d..da0ea8c 100644
--- a/cm17a.c
+++ b/cm17a.c
@@ -216,15 +216,6 @@ static void stdtimer ( void )
 {
    long microsec = configp->cm17a_bit_delay;
 
-#ifdef HASSELECT
-   struct timeval tval;
-
-   tval.tv_sec = microsec / 1000000L;
-   tval.tv_usec = microsec % 1000000L;
-
-   while ( select(0, NULL, NULL, NULL, &tval) == -1 );
-   return;
-#else
 #ifdef NSLEEP
    struct timestruc_t tspec;
 
@@ -250,8 +241,6 @@ static void stdtimer ( void )
 #endif /* ATTSVR4 */
    return;
 #endif
-#endif
-			
 }  
 
 
diff --git a/monitor.c b/monitor.c
index 3f48eb5..666203a 100644
--- a/monitor.c
+++ b/monitor.c
@@ -86,18 +86,6 @@ int c_monitor( int argc, char *argv[] )
     char spoolfile[100];
     time_t time_now, time_prev;
 
-#ifdef HASSELECT
-    extern int tty;
-    int newfd;
-    int rtn;
-    fd_set rfds;
-    struct timeval tv;
-    if ( tty == TTY_DUMMY )
-       newfd = tty;
-    else
-       newfd=dup(tty);
-#endif
-
     sprintf( spoolfile, "%s/%s%s", SPOOLDIR, SPOOLFILE, configp->suffix);
     (void) signal(SIGCHLD, iquit);
     (void) signal(SIGINT, iquit);
@@ -132,20 +120,10 @@ int c_monitor( int argc, char *argv[] )
 	if( f_offset == lseek(sptty, 0, SEEK_END) )  {  /* find end of file */
 	    if( stat( spoolfile, &stat_buf ) < 0)
 	        return(0); 
-#ifndef HASSELECT
+
 	    /* this imposes a delay between the start of new output*/
 	    /* It keeps the disk from being thrashed. */
 	    microsleep(configp->engine_poll);
-#else
-            if ( tty != TTY_DUMMY ) {
-	       FD_CLR(newfd, &rfds);
-	       FD_SET(newfd, &rfds);
-            }
-	    tv.tv_sec = 0;	/* This does it even better */
-	    tv.tv_usec = configp->engine_poll;
-	    if( (rtn = select(1 ,NULL, NULL, NULL, &tv)) < 0 )
-		perror("select failed\n");
-#endif
 	}
 	else {
 	    if ( fstat( sptty, &stat_buf ) < 0 )
@@ -176,18 +154,6 @@ int c_engine( int argc, char *argv[] )
     extern FILE *fdsout;
     extern FILE *fdserr;
     
-#ifdef HASSELECT
-    extern int tty;
-    int newfd;
-    int rtn;
-    fd_set rfds;
-    struct timeval tv;
-    if ( tty == TTY_DUMMY )
-       newfd = tty;
-    else
-       newfd=dup(tty);
-#endif
-
     sprintf( spoolfile, "%s/%s%s", SPOOLDIR, SPOOLFILE, configp->suffix);
 
     (void) signal(SIGINT, engine_quit /*iquit*/);
@@ -227,20 +193,10 @@ int c_engine( int argc, char *argv[] )
 	if ( f_offset == lseek(sptty, 0, SEEK_END) )  {  /* find end of file */
 	    if( stat( spoolfile, &stat_buf ) < 0)
 	       engine_quit(SIGTERM) /* return(0) */; 
-#ifndef HASSELECT
+
 	    /* this imposes a delay between the start of new output*/
 	    /* It keeps the disk from being thrashed. */
 	    microsleep(configp->engine_poll);
-#else
-            if ( tty != TTY_DUMMY ) {
-	       FD_CLR(newfd, &rfds);
-	       FD_SET(newfd, &rfds);
-            }
-	    tv.tv_sec = 0;	/* This does it even better */
-	    tv.tv_usec = configp->engine_poll;
-	    if( (rtn = select(1 ,NULL, NULL, NULL, &tv)) < 0 )
-		perror("select failed\n");
-#endif /* HASSELECT */
 	}
 	else {
 	    if ( fstat( sptty, &stat_buf ) < 0)

commit 5461658d800667fbb3d5311a6b8fa9f5eced5c81
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Jul 10 19:13:49 2011 +0200

    Drop millisleep(10) from xread() not only on Darwin
    
    Commit 6352911c20, "Fix selected Heyu commands waiting forever on
    Darwin", removed a millisleep(10) call from internal loop of xread()
    when built for Darwin. Since there were no reports about more excessive
    load then before on Darwin after this change, and it looks like the
    spool file, from which the xread() is fetching data, is always open in
    blocking mode, preventing read() calls from returning immediately if no
    data and the xread() internal loop from spinning, let's try dropping
    that millisleep(10) completely.
    
    Created against Heyu 2.10-rc1.
    Tested on linux.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/xread.c b/xread.c
index 2922292..dfc3ced 100644
--- a/xread.c
+++ b/xread.c
@@ -136,9 +136,6 @@ unsigned char *buf;
 		{
 		    break;
 		}
-#ifndef DARWIN
-                millisleep(10);  /* Added by CWS */
-#endif
 		continue;
 	    }
 	    if( (i < 0) && (i_am_relay != 1) )

commit 6c656122de401b317cf5b7a051a4d583e1e6e041
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Feb 27 19:31:02 2011 +0100

    Heyu 2.10-rc1
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/version.h b/version.h
index 350efbf..1ac799c 100644
--- a/version.h
+++ b/version.h
@@ -2,5 +2,5 @@
  * It should be manually changed when the version number is ready to be
  * bumped up.
  */
-#define VERSION "2.9.3"
-#define RELEASE_DATE "20110226"
+#define VERSION "2.10-rc1"
+#define RELEASE_DATE "20110227"

commit c1196fecb8410c41c2e069f42115023640ac541a
Merge: 1d3588b b23f63f
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sat Feb 26 20:08:37 2011 +0100

    Merge branch 'stable' into 'for-next'
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

commit 1d3588ba4af168185021cf71a8743df84d1c3401
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue Feb 15 01:36:33 2011 +0100

    Add support for RFXLAN, a networked RFXCOM variant
    
    This patch extends Heyu with the ability to talk to a networked
    version of the RFXCOM RF receiver, named RFXLAN. There should
    be no differences in how both device variants provide Heyu with
    RF signals coming from various Heyu supported RF sensors.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/config.c b/config.c
index 2a39c93..a5c65a0 100644
--- a/config.c
+++ b/config.c
@@ -454,6 +454,8 @@ void initialize_config ( void )
    configp->max_dusk = DEF_MAX_DUSK;
    strncpy2(configp->tty, DEF_TTY, sizeof(config.tty) - 1);
    configp->ttyaux[0] = '\0';
+   configp->auxhost[0] = '\0';
+   configp->auxport[0] = '\0';
    configp->suffixaux[0] = '\0';
    configp->auxdev = 0;
    configp->newformat = 0;
@@ -1306,6 +1308,19 @@ int parse_config_tail ( char *buffer, unsigned char source )
                break;
 	    }
 
+	    if ( ( configp->auxdev == DEV_RFXCOM32 || configp->auxdev == DEV_RFXCOMVL ) && *configp->ttyaux != '/' ) {
+	       sp = strchr(tokv[0], ':');
+
+	       if ( sp ) {
+	          j = sp++ - tokv[0];
+                  if ( j > sizeof(config.auxhost) - 1 )
+	             j = sizeof(config.auxhost) - 1;
+
+                  (void) strncpy2(configp->auxhost, tokv[0], j);
+                  (void) strncpy2(configp->auxport, sp, sizeof(config.auxport) - 1);
+	       }
+	    }
+
             if ( configp->auxdev == DEV_RFXCOMVL && tokc > 2 ) {
                strupper(tokv[2]);
                if ( strcmp(tokv[2], "VISONIC") == 0 )
diff --git a/heyu.1 b/heyu.1
index f9f4dcc..7fef25a 100644
--- a/heyu.1
+++ b/heyu.1
@@ -32,7 +32,8 @@ man page x10config(5).
 .PP
 Heyu supports an auxiliary input device on a second serial port for X10
 RF signals.  Supported devices are the WGL W800RF32A, the X-10 MR26A,
-and the RFXCOM X10 RF Receivers.
+and the RFXCOM X10 RF Receivers. A network version of the RFXCOM receiver,
+RFXLAN, is also supported.
 .PP
 The W800RF32A is manufactured by WGL & Associates (http://www.wgldesigns.com).
 It is available in both a 310 MHz version for operation in the USA and Canada
@@ -395,8 +396,9 @@ be relied on for critical applications.
 .IP \fBaux\fP
 Starts the auxiliary daemon heyu_aux, a background process which
 allows X10 commands to be input to Heyu via RF signals from a W800RF32A,
-MR26A, or RFXCOM serial receiver.  The serial port to which the receiver is
-connected and the receiver device type must be specified in the
+MR26A, or RFXCOM serial receiver, or from an RFXLAN network receiver. 
+The serial port to which the receiver is connected, or the network address
+in case of RFXLAN, and the receiver device type must be specified in the
 configuration file with the TTY_AUX directive.
 .br
 
diff --git a/heyufaq.txt b/heyufaq.txt
index 0ed5dda..b12a031 100644
--- a/heyufaq.txt
+++ b/heyufaq.txt
@@ -1,7 +1,7 @@
 Frequently Asked Questions
 
 This FAQ applies to Heyu Version 2.
-Last updated 09/24/2007
+Last updated 02/14/2011
 
 Q: What is Heyu?
 
@@ -20,7 +20,8 @@ A: The X-10 CM11A power-line communications interface connects to a
 
    Heyu can also receive and process X10 RF signals from a WGL
    W800RF32A, an X-10 MR26A, or RFXCOM RF receiver connected to a
-   second serial port.
+   second serial port, or form an RFXLAN RF receiver connected to a
+   local network.
 
 Q: Why the silly name?
 
@@ -157,12 +158,14 @@ Q: What is the Heyu Auxiliary process?
 
 A: This is a background process, heyu_aux, which will read and decode
    X10 RF signals from an RFXCOM, WGL W800RF32A, or X-10 MR26A RF receiver
-   connected to a second serial port.  The signals can be either transceived
+   connected to a second serial port, or from an RFXLAN RF receiver 
+   connected to a local network.  The signals can be either transceived 
    directly to the power line via the CM11A or are sent to the Heyu State
    Engine for further processing, such as launching scripts.  See the man page
    x10aux(5) for details.
 
-   If the auxiliary serial port and RF receiver type are specified in the
+   If the auxiliary serial port, or the network address in case of the
+   RFXLAN network receiver, and RF receiver type are specified in the
    configuration file with the TTY_AUX directive, this process can be
    started manually by entering 'heyu aux' at the command line, or will
    be started automatically along with Heyu's other background processes
diff --git a/process.h b/process.h
index 351d2eb..ae758b9 100644
--- a/process.h
+++ b/process.h
@@ -1183,6 +1183,8 @@ typedef struct {
   char          tty[PATH_LEN + 1];   /* Serial port to use */
   char          suffix[PATH_LEN + 1]; /* Suffix for file locks */
   char          ttyaux[PATH_LEN + 1]; /* Auxiliary input serial port */
+  char          auxhost[NAME_LEN + 1]; /* Auxiliary input network host address or name */
+  char          auxport[NAME_LEN + 1]; /* Auxiliary input network port number or name */
   char          suffixaux[PATH_LEN + 1]; /* Suffix for aux file lock */
   char          ttyrfxmit[PATH_LEN + 1]; /* RFXmitter serial port */
   unsigned char rfxmit_freq;      /* RFXmitter frequency */
diff --git a/tty_aux.c b/tty_aux.c
index b7d15b0..1e5881e 100644
--- a/tty_aux.c
+++ b/tty_aux.c
@@ -57,6 +57,9 @@
 #include <pty.h>
 #endif
 
+#include <sys/socket.h>
+#include <netdb.h>
+
 #include "x10.h"
 #include "process.h"
 
@@ -156,6 +159,51 @@ int setup_tty_aux( int auxbaud, int lockflag )
     syslog(LOG_ERR, "Opening tty_aux line.");
 #endif
 
+    if ( configp->auxhost[0] && configp->auxport[0] ) {
+       struct addrinfo hints;
+       struct addrinfo *result, *rp;
+       int sfd, s;
+
+       memset(&hints, 0, sizeof(struct addrinfo));
+       hints.ai_family = AF_UNSPEC;	/* Allow IPv4 or IPv6 */
+       hints.ai_socktype = SOCK_STREAM; /* Stream socket */
+       hints.ai_flags = 0;
+       hints.ai_protocol = 0;		/* Any protocol */
+
+       /* Obtain address(es) matching host/port */
+
+       s = getaddrinfo(configp->auxhost, configp->auxport, &hints, &result);
+       if (s != 0) {
+          syslog(LOG_ERR, "getaddrinfo: %s\n", gai_strerror(s));
+       } else {
+          /*
+	   * getaddrinfo() returns a list of address structures.
+	   * Try each address until we successfully connect(2).
+	   * If socket(2) (or connect(2)) fails, we (close the socket
+	   * and) try the next address.
+	   */
+          for (rp = result; rp != NULL; rp = rp->ai_next) {
+	     sfd = socket(rp->ai_family, rp->ai_socktype, rp->ai_protocol);
+	     if (sfd == -1)
+	        continue;
+
+             if (connect(sfd, rp->ai_addr, rp->ai_addrlen) != -1)
+	        break;			/* Success */
+
+	     close(sfd);
+          }
+
+          freeaddrinfo(result);		/* No longer needed */
+
+          if (rp == NULL) {		/* No address succeeded */
+	     syslog(LOG_ERR, "Could not connect\n");
+          } else {
+             tty_aux = sfd;
+             return 0;
+	  }
+       }
+    }
+
 #ifdef O_NONBLOCK
     /* Open with non-blocking I/O, we'll fix after we set CLOCAL */
     tty_aux = open(configp->ttyaux, O_RDWR|O_NONBLOCK);
diff --git a/x10aux.5 b/x10aux.5
index 85e2a99..3f8736f 100644
--- a/x10aux.5
+++ b/x10aux.5
@@ -9,7 +9,8 @@ See  the \fIheyu\fP(1) man page for usage information.
 .PP
 This page contains information about the capability of Heyu to receive
 and process signals from RF remotes and sensors using a WGL W800RF32A, an
-X-10 MR26A, or an RFXCOM X10 RF receiver connected to a second serial port.
+X-10 MR26A, or an RFXCOM X10 RF receiver connected to a second serial port,
+or an RFXLAN network version of the RFXCOM connected to a local network.
 
 .SH HARDWARE
 The W800RF32A is manufactured by WGL & Associates (http://www.wgldesigns.com).
@@ -42,6 +43,10 @@ OS supports the FTDI chipset, as does Linux).
 .PP
 All of these devices are strictly RF receivers and have no transmitting
 capability.
+.PP
+The RFXLAN version of the RFXCOM receiver connects to a local network
+and is accessible over a TCP socket. Its optional transmitter part, if present,
+is not supported.
 
 .SH QUICK START
 Stop Heyu (if already running) with the command 'heyu stop'.
@@ -49,16 +54,19 @@ Plug a W800RF32A/AE or MR26A receiver into a serial port.  Or plug an RFXCOM
 receiver into a USB port and determine the serial device assigned by the
 OS. (Under Linux, the first USB device plugged in will normally be assigned
 to /dev/ttyUSB0, or possibly to /dev/usb/ttyUSB0, the second USB device to
-/dev/ttyUSB1, etc.)
+/dev/ttyUSB1, etc.). Or connect an RFXLAN receiver to your local network and
+configure of verify its network address and port it listens on.
 .PP
 Describe for Heyu the port and receiver being used with the following
 directive in the Heyu configuration file:
 .br
-  TTY_AUX  <serial port>  <receiver device>
+  TTY_AUX  <serial_port or network_address:port>  <receiver device>
 .br
-Example:
+Examples:
 .br
   TTY_AUX  /dev/ttyS1  W800RF32A
+.br
+  TTY_AUX  10.10.10.10:10000  RFXCOM
 .PP
 The configuration directives TRANSCEIVE and RFFORWARD determine whether signals
 from a Standard X10 transmitter (like the HR12A PalmPad) are directly transceived
@@ -184,15 +192,18 @@ in the SPECIAL DS90 SETUP section toward the bottom of this man page.
 In order to receive RF signals, Heyu relies on the heyu_aux
 daemon, which is started either manually with the \'heyu aux\'
 command or automatically in the startup sequence with the
-\'heyu start\' command.  The serial port and attached receiver
+\'heyu start\' command.  The serial port, or network address
+in case of the RFXLAN network receiver, and attached receiver
 device must be specified in the Heyu configuration file with
 the TTY_AUX directive. The syntax for this directive is:
 .br
-  TTY_AUX  <serial port>  <receiver device>
+  TTY_AUX  <serial_port or network_address:port>  <receiver device>
 .br
-where <receiver device> is W800RF32A, MR26A, or RFXCOM.  Example:
+where <receiver device> is W800RF32A, MR26A, or RFXCOM.  Examples:
 .br
   TTY_AUX  /dev/ttyS1  W800RF32A
+.br
+  TTY_AUX  10.10.10.10:10000  RFXCOM
 
 .PP
 RFXCOM defaults to the variable length packet mode model, RFXCOMVL.
diff --git a/x10config.5 b/x10config.5
index 42ecfbc..5d4ba99 100644
--- a/x10config.5
+++ b/x10config.5
@@ -1745,15 +1745,17 @@ man page x10aux(5).
        ===============================================
 
 .SH TTY_AUX directive
-Specify the auxiliary serial port and RF receiver device.
+Specify the auxiliary serial port or network address and RF receiver device.
 .br
 
-  TTY_AUX  <serial port>  <receiver device>
+  TTY_AUX  <serial_port or network_address:port>  <receiver device>
 .br
-where <receiver device> is W800RF32A, MR26A, or RFXCOM.  Example:
+where <receiver device> is W800RF32A, MR26A, or RFXCOM.  Examples:
 .br
   TTY_AUX  /dev/ttyS1  W800RF32A
 .br
+  TTY_AUX  10.10.10.10:10000  RFXCOM
+.br
 
 There is no default for this directive.
 
diff --git a/x10digimax.5 b/x10digimax.5
index c4fbd3d..ccbbcff 100644
--- a/x10digimax.5
+++ b/x10digimax.5
@@ -29,11 +29,12 @@ familiarity with Heyu.
 .PP
 The Heyu configuration file should include the directive:
 .br
-  TTY_AUX  <serial_port> RFXCOM
+  TTY_AUX  <serial_port or network_address:port> RFXCOM
 .br
-where <serial_port> is the port where the RFXCOM receiver is connected.
+where <serial_port> is the port where the RFXCOM receiver is connected,
+or <network_address:port> is where the RFXLAN receiver is listening.
 The RFXCOM receiver connects to a USB port but includes a USB->Serial
-converter chip.
+converter chip, while the RFXLAN connects over a network.
 
 .PP
 Start Heyu with \'heyu start\', then open another xterm window and
diff --git a/x10kaku.5 b/x10kaku.5
index e032b98..476c436 100644
--- a/x10kaku.5
+++ b/x10kaku.5
@@ -28,12 +28,14 @@ familiarity with Heyu.
 .PP
 Include the following directive in the Heyu configuration file:
 .br
-  TTY_AUX  <serial_port>  RFXCOM
+  TTY_AUX  <serial_port or network_address:port>  RFXCOM
 .br
-where <serial_port> is the port where the RFXCOM receiver is connected.
+where <serial_port> is the port where the RFXCOM receiver is connected,
+or <network_address:port> is where the RFXLAN receiver is listening.
 The RFXCOM receiver connects to a USB port but includes a USB->Serial
 converter chip.  At least under Linux, the serial port will have the
 form /dev/ttyUSBn  where n = 0, 1, 2, etc.
+The RFXLAN connects over a network.
 
 .PP
 Configure your KaKu/HomeEasy receiver modules with the remotes
diff --git a/x10oregon.5 b/x10oregon.5
index f541125..a4a57ca 100644
--- a/x10oregon.5
+++ b/x10oregon.5
@@ -34,11 +34,12 @@ familiarity with Heyu.
 .PP
 Include the following directive in the Heyu configuration file:
 .br
-  TTY_AUX  <serial_port>  RFXCOM
+  TTY_AUX  <serial_port or network_address:port>  RFXCOM
 .br
-where <serial_port> is the port where the RFXCOM receiver is connected.
+where <serial_port> is the port where the RFXCOM receiver is connected,
+or <network_address:port> is where the RFXLAN receiver is listening.
 The RFXCOM receiver connects to a USB port but includes a USB->Serial
-converter chip.
+converter chip, while the RFXLAN connects over a network.
 
 .PP
 Start Heyu with \'heyu start\', then open another xterm window and
diff --git a/x10rfxmeters.5 b/x10rfxmeters.5
index a75c1d1..03595bb 100644
--- a/x10rfxmeters.5
+++ b/x10rfxmeters.5
@@ -30,9 +30,10 @@ familiarity with Heyu.
 .PP
 The Heyu configuration file should include the directive:
 .br
-  TTY_AUX  <serial_port> RFXCOM
+  TTY_AUX  <serial_port or network_address:port> RFXCOM
 .br
-where <serial_port> is the port where the RFXCOM receiver is connected.
+where <serial_port> is the port where the RFXCOM receiver is connected,
+or <network_address:port> is where the RFXLAN receiver is listening.
 .PP
 Start Heyu with 'heyu start', then open another xterm window and
 start the Heyu Monitor.

commit 19438693cd1614f3ebac43ed2e4a36b939390c9d
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Mon Feb 7 19:14:13 2011 +0100

    Allow for precise dawn/dusk, night/notnight definition
    
    There was a Heyu configuration directive DAWNDUSK_DEF which allowed
    for selecting one of four fixed dawn/dusk definitions: Sunrise/Sunset,
    Civil Twilight, Nautical Twilight or Astronomical Twilight. Those were
    mapped directly into the dawn/dusk+-nn time specifiers used in the
    Heyu uploaded schedule timers, as well as the night/notnight global
    flags maintained by the Heyu engine and their derivative $X10_DawnTime,
    $X10_DuskTime and $X10_isNightTime environment variables.
    
    There was also an ISDARK_OFFSET configuration directive that allowed
    for specifying time offsets for another pair of the Heyu engine
    maintained global flags, dark/notdark, and their derivative
    $X10_isDarkTime environment variable, relative to the dawn/dusk times.
    
    Due to low resolution of the dawn/dusk possible selections, the
    DAWNDUSK_DEF configuration option was probably hardly used. Instead,
    users tended to place requests for another *_OFFSET option in order
    to have two actually usefull pairs of dark/notdark like global flags.
    
    With this patch applied, users should now be able to define their
    preferred dawn/dusk times very precisely, relative to the Sun position
    at their locations. The night/notnight pair of flags should then
    become more usefull, hopefully providing a replacement for a second
    dark/notdark.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/config.c b/config.c
index c599afa..2a39c93 100644
--- a/config.c
+++ b/config.c
@@ -199,7 +199,7 @@ static struct conf {
    {"XREF_APPEND",          2, 2, 0, 1, COVR|CIGN, Ignored }, 
    {"MACTERM",              2, 2, 0, 1, COVR,    MacTerm }, /* WIP */
    {"RESOLVE_OVERLAP",      2, 2, 0, 1, COVR,    ResOverlap },
-   {"DAWNDUSK_DEF",         2, 2, 0, 1, COVR,    SunMode },
+   {"DAWNDUSK_DEF",         2, 3, 0, 1, COVR,    SunMode },
    {"SCRIPT_MODE",          2, 2, 0, 0, 0,       ScriptMode },
    {"SCRIPT_SHELL",         2, 2, 0, 0, 0,       ScriptShell },
    {"LAUNCH_SOURCE",        2, 6, 0, 0, 0,       LaunchSrc },
@@ -1872,18 +1872,35 @@ int parse_config_tail ( char *buffer, unsigned char source )
 
 	 case SunMode :
 	    strupper(tokv[0]);
-	    if ( strncmp(tokv[0], "RISESET", 1) == 0 )
-	       configp->sunmode = RiseSet;
-	    else if ( strncmp(tokv[0], "CIVILTWI", 1) == 0 )
-	       configp->sunmode = CivilTwi;
-	    else if ( strncmp(tokv[0], "NAUTTWI", 1) == 0 )
-	       configp->sunmode = NautTwi;
-	    else if ( strncmp(tokv[0], "ASTROTWI", 1) == 0 )
-	       configp->sunmode = AstroTwi;
-	    else {
-	       store_error_message("DAWNDUSK_DEF must be R, C, N, or A");
-	       errors++;
+            if ( tokc == 1 ) {
+	       if ( strncmp(tokv[0], "RISESET", 1) == 0 ) {
+	          configp->sunmode = RiseSet;
+		  break;
+               }
+	       else if ( strncmp(tokv[0], "CIVILTWI", 1) == 0 ) {
+	          configp->sunmode = CivilTwi;
+		  break;
+               }
+	       else if ( strncmp(tokv[0], "NAUTTWI", 1) == 0 ) {
+	          configp->sunmode = NautTwi;
+		  break;
+               }
+	       else if ( strncmp(tokv[0], "ASTROTWI", 1) == 0 ) {
+	          configp->sunmode = AstroTwi;
+		  break;
+               }
 	    }
+            else {
+	       sp = NULL;
+	       if ( strncmp(tokv[0], "OFFSET", 1) == 0 ) {
+	          configp->sunmode = AngleOffset;
+                  configp->sunmode_offset = (int)strtol(tokv[1], &sp, 10);
+               }
+               if ( sp && strchr(" \t\n", *sp) )
+	          break;
+            }
+	    store_error_message("DAWNDUSK_DEF must be R, C, N, A or O <int>");
+	    errors++;
 	    break;
 
          case Fix5A :
diff --git a/heyu.1 b/heyu.1
index dfe53e3..f9f4dcc 100644
--- a/heyu.1
+++ b/heyu.1
@@ -459,16 +459,18 @@ configuration is what you think it ought to be.
 \'heyu utility dawndusk\' displays the times of Dawn and Dusk for today.
 .br
 
-\'heyu utility suntable [-r|-c|-n|-a -s -w] [yyyy]\' writes a file to the 
-hard drive containing a daily table of Dawn and Dusk as computed by Heyu for
-your Longitude, Latitude, and Timezone, for the current year or for year yyyy.
-By default, Dawn and Dusk are as defined by the DAWNDUSK_DEF directive in your
-configuration file, times displayed are Civil (i.e., wall-clock) times, and
-the table is 80 columns wide.
-.br
-Switches -r, -c, -n, -a direct Heyu to use the definition of Dawn and Dusk as
-Rise/set, or as Civil, Nautical, or Astronomical Twilight, respectively, and
-overriding the definition of Dawn and Dusk in your configuration file.
+\'heyu utility suntable [-r|-c|-n|-a|-o [-]\fInn\fP] [-s] [-w] [\fIyyyy\fP]\'
+writes a file to the hard drive containing a daily table of Dawn and Dusk as
+computed by Heyu for your Longitude, Latitude, and Timezone, for the current
+year or for year \fIyyyy\fP. By default, Dawn and Dusk are as defined by the
+DAWNDUSK_DEF directive in your configuration file, times displayed are Civil
+(i.e., wall-clock) times, and the table is 80 columns wide.
+.br
+Switches -r, -c, -n, -a or -o [-]\fInn\fP direct Heyu to use the definition of
+Dawn and Dusk as either Sunrise/Sunset, or Civil, Nautical or Astronomical
+Twilight, or a specified position of the Sun centre in angle minutes below the
+horizon (actually above the horizon if \fb-\fInn\fP), respectively, overriding
+the definition of Dawn and Dusk from your configuration file.
 .br
 Switch -s displays times as Standard Time throughout the year instead of
 Civil Time.
diff --git a/process.c b/process.c
index c576dd0..03cfa04 100644
--- a/process.c
+++ b/process.c
@@ -3429,8 +3429,8 @@ void resolve_dawndusk_options ( TEVENT **teventpp, CALEND *calendp )
    julianday = daycount2JD(calendp->today);
 
    for ( j = 0; j < 366; j++ ) {
-      scode[j] = suntimes( latitude, longitude, tzone,
-         julianday, configp->sunmode, &dawn[j], &dusk[j], NULL, NULL );
+      scode[j] = suntimes( latitude, longitude, tzone, julianday,
+         configp->sunmode, configp->sunmode_offset, &dawn[j], &dusk[j], NULL, NULL );
       julianday++ ;
    }
 
@@ -6449,8 +6449,8 @@ int resolve_sun_times( TIMER **timerpp, CALEND *calendp,
    julianday = daycount2JD(calendp->today);
 
    for ( j = 0; j < 366; j++ ) {
-      scode[j] = suntimes( latitude, longitude, tzone,
-         julianday, configp->sunmode, &dawn[j], &dusk[j], NULL, NULL );
+      scode[j] = suntimes( latitude, longitude, tzone, julianday,
+         configp->sunmode, configp->sunmode_offset, &dawn[j], &dusk[j], NULL, NULL );
       julianday++ ;
    }
 
@@ -8273,12 +8273,12 @@ int crontest ( void )
  | Write a table of daily sunrise/set or twilight to disk using        |
  | location and timezone parameters from the configuration file.       |
  +---------------------------------------------------------------------*/
-int write_sun_table ( int format, int year, int sunmode, int timemode )
+int write_sun_table ( int format, int year, int sunmode, int offset, int timemode )
 {
    FILE *fd_sun;
    char filename[256];
    static char *fname[] = {"SunRiseSet", "CivilTwilight",
-      "NautTwilight", "AstronTwilight"};
+      "NautTwilight", "AstronTwilight", "SunAngleOffset", };
 
    get_configuration(CONFIG_INIT);
 
@@ -8297,11 +8297,11 @@ int write_sun_table ( int format, int year, int sunmode, int timemode )
    if ( (fd_sun = fopen(filename, "w")) ) {
       printf("Writing file %s\n", filename);
       if ( format == FMT_PORTRAIT ) {
-         display_sun_table(fd_sun, year, configp->tzone, sunmode, timemode, 
+         display_sun_table(fd_sun, year, configp->tzone, sunmode, offset, timemode, 
              configp->lat_d, configp->lat_m, configp->lon_d, configp->lon_m);
       }
       else {
-         display_sun_table_wide(fd_sun, year, configp->tzone, sunmode, timemode, 
+         display_sun_table_wide(fd_sun, year, configp->tzone, sunmode, offset, timemode, 
              configp->lat_d, configp->lat_m, configp->lon_d, configp->lon_m);
       }
    }
@@ -9688,11 +9688,14 @@ int final_report ( char *pathname, CALEND *calendp, TIMER *timerp,
    else
      (void)fprintf( fd, "Configured for COMPATIBLE mode.\n\n");
 
-   (void)fprintf( fd, "Dawn/Dusk defined as %s\n\n",
-       ((configp->sunmode == RiseSet) ? "Sunrise/Sunset" :
-	(configp->sunmode == CivilTwi) ? "Civil Twilight" :
-	(configp->sunmode == NautTwi) ? "Nautical Twilight" :
-	(configp->sunmode == AstroTwi) ? "Astronomical Twilight" : "???"));
+   (void)fprintf( fd, "Dawn/Dusk defined as ");
+   (void)fprintf( fd, 
+       ((configp->sunmode == RiseSet) ? "Sunrise/Sunset\n\n" :
+	(configp->sunmode == CivilTwi) ? "Civil Twilight\n\n" :
+	(configp->sunmode == NautTwi) ? "Nautical Twilight\n\n" :
+	(configp->sunmode == AstroTwi) ? "Astronomical Twilight\n\n" :
+	(configp->sunmode == AngleOffset) ? "Sun centre at %d angle minutes below horizon\n\n" : "???"),
+	 configp->sunmode_offset);
 
    (void) fprintf( fd, "Actual Event Times (A.E.T.) include macro delay, if any.\n");
    (void) fprintf( fd, "Schedule Times and A.E.T. are Civil Time.\n");
@@ -10212,14 +10215,14 @@ int c_set_status ( int argc, char *argv[] )
  +---------------------------------------------------------------------*/
 int c_utility ( int argc, char *argv[] )
 {
-   int           j, sunmode, timemode, format, year;
+   int           j, sunmode, offset, timemode, format, year;
    time_t        utc0_dawn, utc0_dusk;
    time_t        now;
    struct tm     *tmp;
    char          *sp;
 
    static char   *sunmodelabel[] = {"Sunrise/Sunset", "Civil Twilight",
-        "Nautical Twilight", "Astronomical Twilight"};
+        "Nautical Twilight", "Astronomical Twilight", "Sun angle offset = %d'", };
 
    unsigned long loopcount;
    unsigned long loop_calibrate ( void );
@@ -10242,37 +10245,65 @@ int c_utility ( int argc, char *argv[] )
          now = time(NULL);
          year = localtime(&now)->tm_year + 1900;
          sunmode = configp->sunmode;
+         offset = configp->sunmode_offset;
          timemode = TIMEMODE_CIVIL;
          format = FMT_PORTRAIT;
 
-         if ( argc > 3 && *argv[argc - 1] != '-' ) {
-            year = (int)strtol(argv[argc - 1], &sp, 10);
-            if ( !strchr(" /t/n", *sp) || year < 1970 || year > 2099 ) {
-               fprintf(stderr, "Invalid year '%s'\n", argv[argc - 1]);
-               return 1;
-            }
-            argc--;
-         }
-
          for ( j = 3; j < argc; j++ ) {
-            if ( *argv[j] != '-' ||
-                 strlen(argv[j]) != 2  ||
-                 !(sp = strchr("rcnasw", *(argv[j] + 1)))  ) {
+            if ( *argv[j] == '-' ) {
+	       if ( strlen(argv[j]) >= 2 ) {
+                  sp = argv[j] + 1;
+                  if ( *sp == 'w' && strlen(argv[j]) == 2 ) {
+                     format = FMT_LANDSCAPE;
+		     continue;
+                  }
+                  else if ( *sp == 's' && strlen(argv[j]) == 2 ) {
+                     timemode = TIMEMODE_STANDARD;
+		     continue;
+                  }
+                  else if ( *sp == 'o' ) {
+                     sunmode = AngleOffset;
+	             if ( strlen(argv[j]) > 2 || ( argc > j + 1 && strlen(argv[j + 1]) > 0 ) ) {
+		        if ( strlen(argv[j]) > 2 )
+		           offset = strtol(argv[j] + 2, &sp, 10);
+		        else
+		           offset = strtol(argv[++j], &sp, 10);
+			if (*sp == '\0')
+		        	continue;
+		     }
+	          }
+	          else if ( strlen(argv[j]) == 2 ) {
+	             if ( *sp == 'r' ) {
+		        sunmode = RiseSet;
+                        continue;
+                     }
+                     else if ( *sp == 'c' ) {
+		        sunmode = CivilTwi;
+                        continue;
+                     }
+                     else if ( *sp == 'n' ) {
+		        sunmode = NautTwi;
+                        continue;
+                     }
+                     else if ( *sp == 'a' ) {
+		        sunmode = AstroTwi;
+                        continue;
+                     }
+                  }
+               }
                fprintf(stderr, "Invalid parameter '%s'\n", argv[j]);
                return 1;
             }
-            else if ( *sp == 'w' )
-               format = FMT_LANDSCAPE;
-            else if ( *sp == 's' )
-               timemode = TIMEMODE_STANDARD;
             else {
-               sunmode = ( *sp == 'r' ) ? RiseSet :
-                         ( *sp == 'c' ) ? CivilTwi :
-                         ( *sp == 'n' ) ? NautTwi : AstroTwi ;
+               year = (int)strtol(argv[j], &sp, 10);
+               if ( !strchr(" /t/n", *sp) || year < 1970 || year > 2099 ) {
+                  fprintf(stderr, "Invalid year '%s'\n", argv[argc - 1]);
+                  return 1;
+               }
             }
          }
 
-         return write_sun_table(format, year, sunmode, timemode);
+         return write_sun_table(format, year, sunmode, offset, timemode);
       }
       else if (strcmp("dawndusk", argv[2]) == 0 ) {
          get_configuration(CONFIG_INIT);
@@ -10288,8 +10319,9 @@ int c_utility ( int argc, char *argv[] )
          tmp = localtime(&utc0_dawn);
          printf("Dawn = %02d:%02d %s", tmp->tm_hour, tmp->tm_min, heyu_tzname[tmp->tm_isdst]);
          tmp = localtime(&utc0_dusk);
-         printf("  Dusk = %02d:%02d %s", tmp->tm_hour,  tmp->tm_min, heyu_tzname[tmp->tm_isdst]);
-         printf("  (%s)\n", sunmodelabel[configp->sunmode]);
+         printf("  Dusk = %02d:%02d %s  ", tmp->tm_hour,  tmp->tm_min, heyu_tzname[tmp->tm_isdst]);
+         printf(sunmodelabel[configp->sunmode], configp->sunmode_offset);
+         printf("\n");
          return 0;
       }
          
diff --git a/process.h b/process.h
index fe5e308..351d2eb 100644
--- a/process.h
+++ b/process.h
@@ -339,7 +339,7 @@ enum {SndC, SndM, SndP, SndS, SndT, RcvI, RcvT, SndA, RcvA, Xmtf};
 #define CRON_REPORT_FILE  "cronreport.txt"
 #define SUN_TABLE_FILE    "sun_%d.txt"
 
-enum {RiseSet, CivilTwi, NautTwi, AstroTwi};
+enum {RiseSet, CivilTwi, NautTwi, AstroTwi, AngleOffset, };
 enum {ArmLogicStrict, ArmLogicMedium, ArmLogicLoose};
 
 #define RFXCOM_ARCTECH   0x00000001
@@ -1169,6 +1169,7 @@ typedef struct {
   unsigned char dawn_option;      /* Use First, Average, Median, etc.*/
   unsigned char dusk_option;      /* Use First, Average, Median, etc.*/
   int           sunmode;          /* Definition of Dawn/Dusk */
+  int           sunmode_offset;   /* Custom Dawn/Dusk angle offset */
   int           dawn_substitute;  /* For days when there's no dawn */
   int           dusk_substitute;  /* For days when there's no dusk */
   int           min_dawn;         /* Lower bound on dawn */
@@ -1616,7 +1617,7 @@ int compmac ( struct macindx *, struct macindx * );
 int write_macroxref ( char *, MACRO *, unsigned char *, int );
 int process_data ( int );
 int crontest ( void );
-int write_sun_table ( int, int, int, int );
+int write_sun_table ( int, int, int, int, int );
 int comp_events ( struct ev_s *, struct ev_s * );
 int display_events ( FILE *, TIMER *, TEVENT *, MACRO *, CALEND * );
 int display_timers ( FILE *, TIMER *, TEVENT *, MACRO * );
diff --git a/sun.c b/sun.c
index fc3b5ff..08c0dcf 100644
--- a/sun.c
+++ b/sun.c
@@ -24,15 +24,6 @@
 
 #define KS15   (15. * D2R * MSSR)
 
-/* Zenith angles for Sunrise/set and Twilights */
-#define ANG_RISESET  (90. + 50./60.)
-#define ANG_CIVILTWI (96.)
-#define ANG_NAUTITWI (102.)
-#define ANG_ASTROTWI (108.)
-
-static double zenangle[] = {
-  ANG_RISESET, ANG_CIVILTWI, ANG_NAUTITWI, ANG_ASTROTWI };
-
 /* Local functions */
 static void sun_position ( double, double *, double *);
 static double local_sidereal_time (double, long int, double);
@@ -61,7 +52,7 @@ static double local_sidereal_time (double, long int, double);
 
 int suntimes ( double latitude, double longitude, long int timezone,
                long int JulianDay,
-	       int sunmode,
+	       int sunmode, int offset,
                int *sunrise, int *sunset,
                double *azrise, double *azset)
 {
@@ -78,6 +69,16 @@ int suntimes ( double latitude, double longitude, long int timezone,
              el0, el2, h0, h1, h2, v0, v1, v2,
              d, e, t3, h7, n7, d7, az;
 
+/* Zenith angles for Sunrise/set and Twilights */
+#define ANG_RISESET  (90. + 50./60.)
+#define ANG_CIVILTWI (96.)
+#define ANG_NAUTITWI (102.)
+#define ANG_ASTROTWI (108.)
+#define ANG_ANGOFFS  (90. + offset/60.)
+
+   double zenangle[] = {
+      ANG_RISESET, ANG_CIVILTWI, ANG_NAUTITWI, ANG_ASTROTWI, ANG_ANGOFFS, };
+
 
    *sunrise = *sunset = 0 ;
 
@@ -354,7 +355,7 @@ int local_dawndusk( time_t utc0, time_t *utc0_dawn, time_t *utc0_dusk )
    jd = utc2jd(lutc0);
 
    scode = suntimes(configp->latitude, configp->longitude, configp->tzone, jd,
-               configp->sunmode, &dawn, &dusk, NULL, NULL);
+               configp->sunmode, configp->sunmode_offset, &dawn, &dusk, NULL, NULL);
 
    /* Adjust for abnormal sun conditions */
    abnormal_sun_adjust(scode, &dawn, &dusk);
@@ -381,7 +382,7 @@ int local_dawndusk( time_t utc0, time_t *utc0_dawn, time_t *utc0_dusk )
  | font and landscape mode.                                    |
  +-------------------------------------------------------------*/
 int display_sun_table_wide ( FILE *fd_sun, int year, long timezone,
-    int sunmode, int timemode, int lat_d, int lat_m, int lon_d, int lon_m )
+    int sunmode, int offset, int timemode, int lat_d, int lat_m, int lon_d, int lon_m )
 {
    static struct tzones {
       char *name;
@@ -450,6 +451,9 @@ int display_sun_table_wide ( FILE *fd_sun, int year, long timezone,
       case AstroTwi :	   
          (void) fprintf(fd_sun, "%*sAstronomical Twilight for %d", 26, " ", year);
          break;
+      case AngleOffset :	   
+         (void) fprintf(fd_sun, "%*sSun centre at %d angle minutes below horizon for %d", 26, " ", offset, year);
+         break;
    };
    (void) fprintf(fd_sun, "%*sHEYU ver 2.0 \n\n", 39, " ");
 
@@ -487,8 +491,8 @@ int display_sun_table_wide ( FILE *fd_sun, int year, long timezone,
          }
          julianday = greg2jd( year, month, day );
 
-         retcode = suntimes(latitude, longitude, timezone,
-                 julianday, sunmode, &rise, &set, NULL, NULL );
+         retcode = suntimes(latitude, longitude, timezone, julianday,
+                 sunmode, offset, &rise, &set, NULL, NULL );
 
          yday = (int)(julianday - julianday0);
 
@@ -560,7 +564,7 @@ int display_sun_table_wide ( FILE *fd_sun, int year, long timezone,
  |   3  -> Astronomical Twilight                               |
  +-------------------------------------------------------------*/
 int display_sun_table ( FILE *fd_sun, int year, long timezone,
-    int sunmode, int timemode, int lat_d, int lat_m, int lon_d, int lon_m )
+    int sunmode, int offset, int timemode, int lat_d, int lat_m, int lon_d, int lon_m )
 {
    static struct tzones {
       char *name;
@@ -623,6 +627,9 @@ int display_sun_table ( FILE *fd_sun, int year, long timezone,
       case AstroTwi :	   
          sprintf(minibuf, "Astronomical Twilight for %d\n", year);
          break;
+      case AngleOffset :	   
+         sprintf(minibuf, "Sun centre at %d angle minutes below horizon for %d\n", offset, year);
+         break;
    };
    fprintf(fd_sun, "%*s%s", (80 - (int)strlen(minibuf))/2, " ", minibuf);
    (void) fprintf(fd_sun, "\nLocation: ");
@@ -676,8 +683,8 @@ int display_sun_table ( FILE *fd_sun, int year, long timezone,
 
             yday = (int)(julianday - julianday0);
 
-            retcode = suntimes(latitude, longitude, timezone,
-                    julianday, sunmode, &rise, &set, NULL, NULL );
+            retcode = suntimes(latitude, longitude, timezone, julianday,
+                    sunmode, offset, &rise, &set, NULL, NULL );
 
             if ( timemode == TIMEMODE_CIVIL ) {
                /* Adjust times for Daylight Time */
diff --git a/sun.h b/sun.h
index 4e99909..577aa58 100644
--- a/sun.h
+++ b/sun.h
@@ -12,11 +12,11 @@
 #define TIMEMODE_STANDARD   0
 #define TIMEMODE_CIVIL      1
 
-int suntimes ( double, double, long int, long int, int,
+int suntimes ( double, double, long int, long int, int, int,
               int *, int *, double *, double * );
 long int greg2jd ( int, int, int );
-int display_sun_table (FILE *, int, long, int, int, int, int, int, int);
-int display_sun_table_wide (FILE *, int, long, int, int, int, int, int, int);
+int display_sun_table (FILE *, int, long, int, int, int, int, int, int, int);
+int display_sun_table_wide (FILE *, int, long, int, int, int, int, int, int, int);
 int local_dawndusk ( time_t, time_t *, time_t * );
 
 
diff --git a/x10config.5 b/x10config.5
index acd99d6..42ecfbc 100644
--- a/x10config.5
+++ b/x10config.5
@@ -1468,7 +1468,9 @@ on and off.  (Heyu maintains the ordering in macros to the extent possible.)
 .SH DAWNDUSK_DEF directive
 By default Heyu defines Dawn and Dusk to be Sunrise and Sunset.  This
 directive allows globally defining them instead as the morning and
-evening times of several standard twilights, as follows:
+evening times of several standard twilights, or as times calculated for
+a custom position of the Sun centre below the horizon, specified in angle
+minutes, as follows:
 .br
 RISESET (or simply \'R\') - Sunrise and Sunset (default)
 .br
@@ -1478,12 +1480,17 @@ NAUTICAL (or simply \'N\') - Nautical Twilight
 .br
 ASTRONOMICAL (or simply \'A\') - Astronomical Twilight
 .br
+OFFSET [-]\fINN\fP (or simply \'O\ [-]\fINN\fP') - Sun position in angle
+minutes below the horizon (actually above the horizon if \fb-\fINN\fP)
+.br
 
 Example:
 .br
   DAWNDUSK_DEF  CIVIL
 .br
   DAWNDUSK_DEF  N
+.br
+  DAWNDUSK_DEF  OFFSET 0
 
 .SH DAWN_OPTION directive
 .SH DUSK_OPTION directive
diff --git a/x10sched.5 b/x10sched.5
index bceec2f..9a67824 100644
--- a/x10sched.5
+++ b/x10sched.5
@@ -217,8 +217,8 @@ with an error message.
 
 Dawn and Dusk are defined by default to be synonymous with sunrise and
 sunset.  However this definition may be _globally_ changed to one or
-another of the standard twilight times with the configuration file
-directive DAWNDUSK_DEF.  See man page x10config(5).
+another of the standard twilight times, or to a user specified Sun position,
+with the configuration file directive DAWNDUSK_DEF.  See man page x10config(5).
 .br
 
 When Heyu processes Dawn or Dusk related events, it subdivides the
diff --git a/x10state.c b/x10state.c
index 7f7ae0d..9138850 100644
--- a/x10state.c
+++ b/x10state.c
@@ -13261,7 +13261,7 @@ int show_state_dawndusk ( void )
    time_t      midnight;
 
    static char   *sunmodelabel[] = {"Sunrise/Sunset", "Civil Twilight",
-        "Nautical Twilight", "Astronomical Twilight"};
+        "Nautical Twilight", "Astronomical Twilight", "Sun angle offset = %d'", };
 
    if ( configp->loc_flag != (LONGITUDE | LATITUDE) ||
         x10global.dawndusk_enable == 0 ) {
@@ -13284,8 +13284,9 @@ int show_state_dawndusk ( void )
    printf("Dawn = %02d:%02d %s", tmp->tm_hour, tmp->tm_min, heyu_tzname[tmp->tm_isdst]);
 
    tmp = localtime(&x10global.utc0_dusk);
-   printf("  Dusk = %02d:%02d %s", tmp->tm_hour,  tmp->tm_min, heyu_tzname[tmp->tm_isdst]);
-   printf("  (%s)\n", sunmodelabel[configp->sunmode]);
+   printf("  Dusk = %02d:%02d %s  ", tmp->tm_hour,  tmp->tm_min, heyu_tzname[tmp->tm_isdst]);
+   printf(sunmodelabel[configp->sunmode], configp->sunmode_offset);
+   printf("\n");
 
    return 0;
 }

commit 027db5f4cd280c155c8aefc0fe905e3c419a55fb
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Wed Dec 15 17:11:34 2010 +0100

    Use microsleep(ENGINE_POLL) instead of sleep(1)
    
    Now that we stopped using select() as a *sleep() replacement on linux,
    both the Heyu engine and monitor fall back to polling the spool file
    once a second while idle, irrespective of the ENGINE_POLL value, either
    default or redefined in an x10config file.
    
    In order to keep the ENGINE_POLL directive effective on linux, replace
    the fallback arbitrary sleep(1) with an already defined custom
    microsleep() function call, which is supposed to be portable.
    
    This should make the ENGINE_POLL being respected on other platforms
    as well, which have never been build with HASSELECT defined.
    
    Created and tested against heyu-2.9.2.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/monitor.c b/monitor.c
index 83700f7..3f48eb5 100644
--- a/monitor.c
+++ b/monitor.c
@@ -133,9 +133,9 @@ int c_monitor( int argc, char *argv[] )
 	    if( stat( spoolfile, &stat_buf ) < 0)
 	        return(0); 
 #ifndef HASSELECT
-	    /* this imposes a 1 second delay between the start of new output*/
+	    /* this imposes a delay between the start of new output*/
 	    /* It keeps the disk from being thrashed. */
-	    sleep(1);
+	    microsleep(configp->engine_poll);
 #else
             if ( tty != TTY_DUMMY ) {
 	       FD_CLR(newfd, &rfds);
@@ -228,9 +228,9 @@ int c_engine( int argc, char *argv[] )
 	    if( stat( spoolfile, &stat_buf ) < 0)
 	       engine_quit(SIGTERM) /* return(0) */; 
 #ifndef HASSELECT
-	    /* this imposes a 1 second delay between the start of new output*/
+	    /* this imposes a delay between the start of new output*/
 	    /* It keeps the disk from being thrashed. */
-	    sleep(1);
+	    microsleep(configp->engine_poll);
 #else
             if ( tty != TTY_DUMMY ) {
 	       FD_CLR(newfd, &rfds);

commit 82c21e413300ece82b2b7f2d22ec3e5523d62246
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Wed Dec 15 17:11:34 2010 +0100

    Stop using select() as a *sleep() replacement on linux
    
    It has been prooved that using select() as a replacement for a *sleep()
    while looping through the spool file monitoring functions c_engine() and
    c_monitor(), may cause a not yet clearly understood problem to occure
    when running on a relatively recent GNU/Linux platform, like Fedora 13.
    
    Don't define HASSELECT for linux any more.
    
    Created and tested against heyu-2.9.2.
    
    Reported-by: ccataldo@cox.net
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/Configure b/Configure
index 0271209..3b2978b 100755
--- a/Configure
+++ b/Configure
@@ -139,7 +139,7 @@ case "$SYS" in
 	GROUP = root 
 	CC = gcc
 	CFLAGS = -g -O \$(DFLAGS) -Wall
-	DFLAGS = -DSYSV -DPOSIX -DHAS_ITIMER -DLINUX -DHASSELECT -DHASTZ $CM17AFLAG $EXT0FLAG $RFXSENFLAG $RFXMETFLAG $DMXFLAG $OREFLAG $KAKUFLAG $FLAGS_FLAG $TIMERS_FLAG $COUNTERS_FLAG
+	DFLAGS = -DSYSV -DPOSIX -DHAS_ITIMER -DLINUX -DHASTZ $CM17AFLAG $EXT0FLAG $RFXSENFLAG $RFXMETFLAG $DMXFLAG $OREFLAG $KAKUFLAG $FLAGS_FLAG $TIMERS_FLAG $COUNTERS_FLAG
 	LIBS = -lm -lc
 EoF
 	;;

commit 187d0e4c33621ea227369545f9cedc31eef66bd8
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Wed Dec 1 20:07:33 2010 +0100

    extend rcs thermostat functions
    
    With this patch applied, Heyu should try to decode and display three
    more message types that can preceed temperature data reports: "Outside
    Temperature", "Heat Setpoint" and "Cooling Setpoint". These labels
    should be displayed in both the Heyu monitor output as well as the Heyu
    engine log, but not from the rcs_req command line (only the temperature
    is displayed if received on time, like it was before).
    
    Reported-by: Brandt Daniels <PompRocker@aol.com>
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index 77322f8..d85d081 100644
--- a/poll.c
+++ b/poll.c
@@ -219,9 +219,10 @@ int check4poll( int showdata, int timeout )
 
 
   
-    static char *rcs_status[10] = {
+    static char *rcs_status[] = {
        "System_mode = OFF", "System_mode = HEAT", "System_mode = COOL", "System_mode = AUTO",
-       "Fan = ON", "Fan = OFF", "Setback = ON", "Setback = OFF", "Temp Change", "Setpoint Change"
+       "Fan = ON", "Fan = OFF", "Setback = ON", "Setback = OFF", "Temp Change", "Setpoint Change",
+       "Outside Temp", "Heat Setpoint", "Cooling Setpoint",
     };
     static unsigned int source_type[] = {SNDC, SNDS, SNDP, SNDA, RCVA};
     static char *source_name[] = {"sndc", "snds", "sndp", "snda", "rcva"};
@@ -824,7 +825,7 @@ int check4poll( int showdata, int timeout )
                                           fprintf(fdsout, "%s %-22s : hu %c0  (%s)\n",
                                             datstrf(), minibuf, toupper((int)lasthc), lookup_label(lasthc, 0));
                                        }
-                                       else if ( lastunit == 6 && predim < 11 ) {
+                                       else if ( lastunit == 6 && predim < sizeof(rcs_status) / sizeof(*rcs_status) + 1 ) {
                                           fprintf(fdsout, "%s %-22s : hu %c0  (%s)\n",
                                             datstrf(), rcs_status[predim - 1], toupper((int)lasthc),
                                                                    lookup_label(lasthc, 0));

commit 275f5d6458b8adf3c2fdcb6a8cf891ced48cf909
Merge: 5f25449 4e0c5aa
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue Dec 7 15:35:23 2010 +0100

    Merge branch 'master' into jk/for-next

commit 5f25449a3ed33360b21afed935d125394d21fed4
Merge: 571e23d 14176c8
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Fri Nov 26 01:13:26 2010 +0100

    Merge branch 'jk/checksum_timeout' into for-next
    
    Conflicts:
    	cmd.c

commit 14176c81d0d46cb4cbb7c2715a4722db621a6e72
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 15 23:06:22 2010 +0200

    Cmd: Limit the wait for checksum timeout to 1 second
    
    In the current send_buffer() implementation, used for sending out powerline
    signals from a command line, the same timeout value of 10s, as forced by the
    calling functions, is used when waiting for both a checksum and READY
    response.
    
    It has been observed that a checksum response is either received immediatelly
    or not at all. Then, waiting for 10 seconds seems useless, and even harmfull
    since a heyu write lock is kept, preventing other commands from being run.
    
    The patch limits the wait for checksum timeout to 1 second, that seems way
    enough.
    
    Created and tested against heyu-2.9.0.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/cmd.c b/cmd.c
index ea5a510..0abf443 100644
--- a/cmd.c
+++ b/cmd.c
@@ -1303,7 +1303,7 @@ int send_buffer ( unsigned char *buffer, int length,
 
    /* get a check sum in reply */
 
-   nread = exread(sptty, inbuff, 1, timeout);
+   nread = exread(sptty, inbuff, 1, 1);
 
    if ( chksum == inbuff[0] ) {
       /* Checksum is OK; tell interface to transmit the code. */

commit 58ccc4366e044a8daf2f3be9639594f4c71ad215
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 15 23:04:02 2010 +0200

    Cmd: Add distinct reporting of no checksum response
    
    In the current send_buffer() implementation, used for sending out powerline
    signals from a command line, if a wait for checksum timeout occures, it is not
    reported, even in verbose mode, other than incorrectly as a wrong checksum.
    This could effectively hide this potential source of other heyu problems,
    like "Unable to lock ..." events, from users and developers attention for
    years.
    
    This patch adds a distinct warning message in order to get users and
    developers attention to these rare, but harmful events. To not force users
    runnig commands in verbose mode, the events are reported unconditionally to
    the syslog as well.
    
    Created and tested against heyu-2.9.0.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/cmd.c b/cmd.c
index f0b41d7..ea5a510 100644
--- a/cmd.c
+++ b/cmd.c
@@ -63,6 +63,7 @@
 #include <sys/time.h>
 #endif /* NSLEEP | ATTSVR4 */
 
+#include <syslog.h>
 #include <time.h>
 #include <sys/time.h>
 #include <limits.h>
@@ -1316,6 +1317,12 @@ int send_buffer ( unsigned char *buffer, int length,
 
       (void) xwrite(tty, "\00" , 1);	/* WRMI (we really mean it) */
    }
+   else if (!nread) {
+      if ( verbose )
+         display_send_message("Checksum NOT confirmed, no response from interface");
+      syslog(LOG_WARNING, "Checksum NOT confirmed, no response from interface");
+      return 1;
+   }
    else  {
       if ( verbose ) {
          sprintf(msgbuff, "Checksum %02x NOT confirmed - should be %02x\n",

commit 571e23d7563576b8d8c832709f1411fe561d09b4
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Tue Nov 16 16:43:03 2010 +0100

    Cmd: don't hide checksums from the engine
    
    Using exread() for marking checksums to be recognized and ignored by the
    engine proved to be very error prone. Now that we have teached the engine to
    recognize checksums even if not marked, we can drop using this problematic
    function in favour of a simple xread(), that is free of similiar issues.
    
    This patch replaces exread() with xread() inside the send_buffer(), used by
    heyu commands, when reading checksums from the spool file.
    
    Initially created against heyu-2.3.0 and tested extensively since then. While
    corrected the core problem, it introduced a harmless side effect of
    dummy "Poll received unknown value ..." error messages acompanying every
    checksum.
    
    This version, refreshed against 2.9.0, applies and compiles on top of the
    former patch, Cmd: Avoid hiding a CM11 message got when awaiting 0x55,
    (http://tech.groups.yahoo.com/group/heyu_devel/message/4)
    
    Should work correctly, without the side effects mentioned, when used on top
    of the other 3 patches from this series.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/cmd.c b/cmd.c
index 383b129..5dd767f 100644
--- a/cmd.c
+++ b/cmd.c
@@ -1302,7 +1302,7 @@ int send_buffer ( unsigned char *buffer, int length,
 
    /* get a check sum in reply */
 
-   nread = exread(sptty, inbuff, 1, timeout);
+   nread = xread(sptty, inbuff, 1, timeout);
 
    if ( chksum == inbuff[0] ) {
       /* Checksum is OK; tell interface to transmit the code. */

commit 51c071eb3d03fef91758030c21df470ca5949e6c
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Mon Aug 16 17:44:02 2010 +0200

    Engine: use correct checksum with CM11 upload
    
    The identify_sent() provided checksums are incorrect in case of CM11 upload
    commands.
    
    Since correct upload checksums are already calculated inside
    translate_other(), which is called from check4poll() for every upload command,
    we can obtain correct upload checksums by extending the translate_other()
    function API, as we already did to identify_sent() for use with other CM11
    commands.
    
    The patch implements this idea.
    
    Created and briefly tested against heyu-2.9.0 on top of patch 2/4.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index e026a8f..77322f8 100644
--- a/poll.c
+++ b/poll.c
@@ -170,7 +170,7 @@ int check4poll( int showdata, int timeout )
     extern int display_expanded_macro();
     int ichksum;
     int identify_sent(unsigned char *, int, unsigned char *);
-    char *translate_other(unsigned char *, int);
+    char *translate_other(unsigned char *, int, unsigned char *);
     extern char *translate_sent(unsigned char *, int, int *);
     extern char *translate_rf_sent(unsigned char *, int *);
 #if 0
@@ -551,7 +551,7 @@ int check4poll( int showdata, int timeout )
                    }
                    else if ( sent_type == SENT_OTHER ) {
                       /* Other command */
-                      if ( *(transp = translate_other(buf, n)) )
+                      if ( *(transp = translate_other(buf, n, &chksum)) )
                          fprintf(fdsout, "%s %s\n", datstrf(), transp);
 		      chksum_alert = chksum;
                       launchp = -1;
diff --git a/x10state.c b/x10state.c
index 5305824..f6839ca 100644
--- a/x10state.c
+++ b/x10state.c
@@ -6677,20 +6677,19 @@ char *translate_rf_sent ( unsigned char *buf, int *launchp )
 /*---------------------------------------------------------------------+
  | Interpret byte string sent to CM11A.                                |
  +---------------------------------------------------------------------*/
-char *translate_other ( unsigned char *buf, int len )
+char *translate_other ( unsigned char *buf, int len, unsigned char *chksum )
 { 
    static char outbuf[80];
-   unsigned char chksum;
    unsigned int memloc;
 
    if ( buf[0] == 0 && len == 1 ) {
       return "";
    }
    else if ( buf[0] == 0xfb && len == 19 ) {
-      chksum = checksum(buf + 1, len - 1);
+      *chksum = checksum(buf + 1, len - 1);
       memloc = (buf[1] << 8) + buf[2];
       sprintf(outbuf, "Upload to EEPROM location %03x, checksum = %02x",
-          memloc, chksum);
+          memloc, *chksum);
       return outbuf;
    }
    else if ( buf[0] == 0x8b && len == 1 ) {

commit 2cd54bdeb989c8f39ea6a96a6d2706bf88811ed5
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Mon Aug 16 17:32:58 2010 +0200

    Engine: use chksum_alert for all CM11 commands
    
    To prevent the engine from displaying the "Poll received unknown value ..."
    message when a raw checkum byte is read from the spool file, store a checksum
    calculated for a CM11 command in the chksum_alert variable, which is then used
    for matching expected checksum bytes. IOW, reuse the already implemented
    chksum_alert algorithm for matching all outgoing CM11 command checksums.
    
    Created and briefly tested against heyu-2.9.0 on top of patch 1/4.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index d2559de..e026a8f 100644
--- a/poll.c
+++ b/poll.c
@@ -388,6 +388,7 @@ int check4poll( int showdata, int timeout )
                       /* An address */
                       if ( *(transp = translate_sent(buf, n, &launchp)) )
                          fprintf(fdsout, "%s %s %s\n", datstrf(), send_prefix, transp);
+		      chksum_alert = chksum;
                       if ( launchp >= 0 && i_am_state) {
                          launch_scripts(&launchp);
                       }
@@ -396,6 +397,7 @@ int check4poll( int showdata, int timeout )
                       /* Standard function */
                       if ( *(transp = translate_sent(buf, n, &launchp)) )
                          fprintf(fdsout, "%s %s %s\n", datstrf(), send_prefix, transp);
+		      chksum_alert = chksum;
                       if ( launchp >= 0 && i_am_state) {
                          launch_scripts(&launchp);
                       }
@@ -404,6 +406,7 @@ int check4poll( int showdata, int timeout )
                       /* Extended function */
                       if ( *(transp = translate_sent(buf, n, &launchp)) )
                          fprintf(fdsout,"%s %s %s\n", datstrf(), send_prefix, transp);
+		      chksum_alert = chksum;
                       if ( launchp >= 0 && i_am_state) {
                          launch_scripts(&launchp);
                       }
@@ -550,6 +553,7 @@ int check4poll( int showdata, int timeout )
                       /* Other command */
                       if ( *(transp = translate_other(buf, n)) )
                          fprintf(fdsout, "%s %s\n", datstrf(), transp);
+		      chksum_alert = chksum;
                       launchp = -1;
                    }
 

commit ca9184c2f4fdfb9f8231023c261c934d3ad42774
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Mon Aug 16 17:29:48 2010 +0200

    Engine: provide check4poll() with checksums
    
    In order to teach the engine how to recognize checksum bytes related to
    outgoing CM11 commands, including powerline signals, found in the byte stream
    read from the spool file, the check4poll() function must get access to
    checksum values calculated for the relevant command sequences.
    
    This patch allows for this by modifying the API of the identify_sent()
    function, called by the check4poll(), adding a checksum, that is already
    computed inside the identify_sent() body, to the list of its returned
    variables.
    
    Created and briefly tested against heyu-2.9.0.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/poll.c b/poll.c
index 953c0a0..d2559de 100644
--- a/poll.c
+++ b/poll.c
@@ -169,7 +169,7 @@ int check4poll( int showdata, int timeout )
     extern int special_func;
     extern int display_expanded_macro();
     int ichksum;
-    int identify_sent(unsigned char *, int);
+    int identify_sent(unsigned char *, int, unsigned char *);
     char *translate_other(unsigned char *, int);
     extern char *translate_sent(unsigned char *, int, int *);
     extern char *translate_rf_sent(unsigned char *, int *);
@@ -274,11 +274,13 @@ int check4poll( int showdata, int timeout )
 		n = buf[0];
 
                 if ( n < 127 ) {
+		   unsigned char chksum;
+
                    n = xread(sptty, buf, n, timeout);
 
                    /* Identify the type of sent command from the leading */
                    /* byte and the length of the buffer.                 */
-                   sent_type = identify_sent(buf, n);
+                   sent_type = identify_sent(buf, n, &chksum);
 
                    if ( sent_type == SENT_STCMD ) {
                       /* A command for the monitor/state process */
diff --git a/x10state.c b/x10state.c
index 08d1642..5305824 100644
--- a/x10state.c
+++ b/x10state.c
@@ -5726,12 +5726,11 @@ int fetch_x10state_old ( void )
  | Identify the type of data read from the spoolfile which was written |
  | there by heyu, i.e., excluding data received from the interface.    |
  +---------------------------------------------------------------------*/
-int identify_sent ( unsigned char *buf, int len )
+int identify_sent ( unsigned char *buf, int len, unsigned char *chksum )
 {
    int type;
-   unsigned char chksum;
 
-   chksum = checksum(buf, len);
+   *chksum = checksum(buf, len);
    
    if ( buf[0] == 0 && len == 1 )
       type = SENT_WRMI;  /* WRMI */
@@ -5784,7 +5783,7 @@ int identify_sent ( unsigned char *buf, int len )
       type = SENT_STCMD;  /* Monitor/state control command */
    else if ( buf[0] == 0x0C && len == 2 && buf[1] == 0x56 )
       type = SENT_ADDR;  /* Address of G1 with 5a fix */
-   else if ( buf[0] == 0x0F && len == 5 && chksum == 0x62 )
+   else if ( buf[0] == 0x0F && len == 5 && *chksum == 0x62 )
       type = SENT_EXTFUNC;  /* Extended function with 5a fix */
    else if ( buf[0] == ST_COMMAND && buf[1] == ST_SETTIMER && len == 8 )
       type = SENT_SETTIMER; /* Set a countdown timer */

commit c971e6386e3a754034f3d295387cca87bd1d711d
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 15 20:16:44 2010 +0200

    Cmd: Avoid hiding a CM11 message got when awaiting 0x55
    
    Current send_buffer() routine, used by heyu command line for sending out
    powerline signals, tries to mark hidden all responses expected from the CM11
    during X10 signal submission, in order to prevent the heyu_engine from
    interpreting them as parts of incoming transmissions. There are two such
    responses expected: a checksum, and finally the READY byte (0x55).
    
    If it ever happens that an incomming signal is received during the send out
    procedure, a poll request byte (0x5a) can be received instead of the expected
    checksum or READY. Then, this 0x5a byte gets marked hidden instead of the
    expected one, effectively destroing full incoming powerline sequence (0x5a
    + the sequence) and preventing it from being recognized correctly by the
    heyu_engine. As a result, the incoming powerline signal gets lost, and the
    infamous "Poll received unknown value ..." message appears instead.
    
    This patch tries to correct the problem in case of incoming signal
    transmission received instead of expected READY. This can be done by simply
    not marking the expected 0x55 as hidden, since the engine is prepared for
    interpreting it correctly as a READY response. Then, any different byte
    received instead won't get marked as hidden as well and can be interpreted
    correctly by the engine.
    
    This is achieved by using xread(), that simply reads a response from the spool
    file, instead of the exread(), that starts with putting a "hidden" mark into
    the spool file, then calls xread().
    
    Unfortunatelly, this simple solution can't be used for correcting the problem
    in case of an incomming transmission received instead of checksum (actually,
    I have been using this method for several months, accepting false "Poll
    received unknown value ..." messages appearing in my log for every correct
    checksum received). An alternative solution has to be worked out.
    
    Initially created against heyu-2.3.0 and tested extensively since then. The
    herewith submitted version has been refreshed against heyu-2.9.0.
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/cmd.c b/cmd.c
index f0b41d7..383b129 100644
--- a/cmd.c
+++ b/cmd.c
@@ -85,7 +85,7 @@ extern int line_no;
 extern int sptty, i_am_relay, i_am_aux, i_am_state;
 extern int heyu_parent;
 extern int verbose;
-extern int xwrite(), exread(), sxread(), check4poll();
+extern int xwrite(), xread(), exread(), sxread(), check4poll();
 extern int is_modem_support(void);
 extern CONFIG  config;
 extern CONFIG  *configp;
@@ -1325,7 +1325,7 @@ int send_buffer ( unsigned char *buffer, int length,
       return 1;
    }
 
-   if ( (nread = exread(sptty, inbuff, 1, timeout)) >= 1 ) {
+   if ( (nread = xread(sptty, inbuff, 1, timeout)) >= 1 ) {
       if( inbuff[0] == 0x55 ) {
          /* interface is ready again */
          if ( verbose )

commit 8c5e0e64e3ad86ff5f176c787803fecc00a1d5e8
Author: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>
Date:   Sun Aug 15 18:58:54 2010 +0200

    Relay: Prevent incoming powerline signals from being destroyed by other signals
    
    In its current form, the heyu_relay puts an incomming poll request (0x5a) byte
    and a following signal(s) byte sequence into the spool file in two separate
    write() calls. Since this procedure doesn't respect spool file locks, it may
    happen that another signal, whether a command line, heyu_aux or whatever its
    source can be, gets inserted into the spool file inbetween, effectivelly
    destroying the full byte sequence required by the heyu_engine to actually
    recognize an incomming signal(s) sequence. This results in powerline signals
    happening to get lost, with the infamous "Poll received unknown value ..."
    error message being displayed.
    
    This patch tries to correct the problem by first collecting the whole
    sequence, consisting of one poll request (0x5a) byte and a subsequent
    incomming command(s) bytes, and then putting it into the spool file with one
    atomic write() call.
    
    I have initially created this patch against heyu-2.3.0 and tested extensively
    since then. The below version is refershed against current official release
    (2.9.0).
    
    Signed-off-by: Janusz Krzysztofik <jkrzyszt@tis.icnet.pl>

diff --git a/relay.c b/relay.c
index 6a5def0..a764cb4 100644
--- a/relay.c
+++ b/relay.c
@@ -367,7 +367,7 @@ int start_relay ( char *tty_name )
 	    /* just write any unknown data */
 	    ignoret = write(outfd,ibuff, 1);
         }
-
+#if 0
 	if ( ibuff[0] == 0x5a && (count_5a == 0 || in_sync == 1 ) )  {
 	    /* write the first 0x5a that's seen */
 	    ignoret = write(outfd,ibuff, 1);
@@ -377,19 +377,19 @@ int start_relay ( char *tty_name )
 	     * let's try that next time that I'm deep into the code.
 	     */
 	}
-
+#endif
 	if ( ibuff[0] == 0x5a && count == 1)  {
 
             /* CM11A has a character to read */
 	    if ( ++count_5a > 1 || (count_5a == 1 && in_sync == 1) )  {
                 /* After a (configurable) short delay, tell the CM11A to send it */
                 millisleep(configp->cm11a_query_delay);
-		ibuff[0] = 0xC3;
+		ibuff[1] = 0xC3;
 
 		/* if( lock_for_write() == 0 ) */
 		{
 		    port_locked = 1;
-		    ignoret = write(tty,ibuff, 1);
+		    ignoret = write(tty,ibuff + 1, 1);
 		    munlock(writefilename);
                     port_locked = 0;
 		}
@@ -401,12 +401,12 @@ int start_relay ( char *tty_name )
 		 * Like power fail or hail request.
 		 */
 
-	         count = sxread(tty, ibuff, 1, 5);  	/* Get number of bytes which follow */
+	         count = sxread(tty, ibuff + 1, 1, 5); 	/* Get number of bytes which follow */
 	         				      
 	         if ( count == 1 ) {
                      /* so far so good */
 
-		     expected = ibuff[0];
+		     expected = ibuff[1];
 
                      if ( expected == 0x5a ) {
                         /* CM11A quirk - sometimes send 0xC3, get nothing */
@@ -417,25 +417,25 @@ int start_relay ( char *tty_name )
                      }
 
 		     if ( expected > 20 )  {
-                         ignoret = write(outfd,ibuff, 1);
+                         ignoret = write(outfd,ibuff, 2);
                          /* Too many. We must not be synced. */
 		         in_sync = 0;
 		         continue; /* go to outer while to grab this */
 		     }
 
-                     count = sxread(tty, ibuff + 1, expected, 5);
+                     count = sxread(tty, ibuff + 2, expected, 5);
 
 		     if ( count != expected )  {
 		         /* This should be too few. so we aren't in sync yet. */
-                         ibuff[0] = count;
-		         ignoret = write(outfd,ibuff, count + 1);
+                         ibuff[1] = count;
+		         ignoret = write(outfd,ibuff, count + 2);
 		         in_sync = 0;
 		         continue; /* go to outer while to grab this */
 		     }
 		     if ( count == expected )  {
 			count_5a = 0;
 			in_sync = 1;
-			ignoret = write(outfd,ibuff, count + 1);
+			ignoret = write(outfd,ibuff, count + 2);
                      }
 
 	         }
